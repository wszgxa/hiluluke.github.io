<!DOCTYPE html>
<html>
  <head>
    
    <title>
    
    记一次首屏优化 
      
    
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="utf-8">
    <link rel="alternate" href="/atom.xml" title="hilu&#39;s note" type="application/atom+xml">
    
    <link rel="icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">
  </head>
<body>
  <script type="text/javascript">
    // fix sidebar flashing
    (function(){
      if (localStorage.getItem('sidebarState') == 'true') {
        document.body.className="sideShow"
      }
    })()
  </script>
  <div id="container">
    <aside class="sidebar">
  <div class="head-icon">
  
    <a href="/about">
      <img src="/avatar.jpeg">
    </a>
  
  </div>
  <div class="name">hiluluke</div>
  <div class="desc">
    <h4>我是一个粉刷匠</h4>  
  </div>
  <nav class="side-nav">
    <div class="nav-item">
      <a href="/archives">
        <span>
          26
        </span>
        <span>日志</span>
      </a>
    </div>
    <div class="nav-item">
      <a href="/categories">
        <span>
          7
        </span>
        <span>分类</span>
      </a>
    </div>
    <div class="nav-item">
      <a href="/tags">
        <span>
          22
        </span>
        <span>标签</span>
      </a>
    </div>
  </nav>
  
  <div class="social-wrap">
    
    <a href="https://github.com/wszgxa" target="_blank">
      <div class="item">
        <i class="i-github"></i>
      </div>
    </a>
    
    <a href="http://v2ex.com/member/hiluluke" target="_blank">
      <div class="item">
        <i class="i-v2ex"></i>
      </div>
    </a>
    
    <a href="https://www.zhihu.com/people/zhao-guo-xu" target="_blank">
      <div class="item">
        <i class="i-zhihu"></i>
      </div>
    </a>
    
    <a href="https://twitter.com/Hiluluke" target="_blank">
      <div class="item">
        <i class="i-twitter"></i>
      </div>
    </a>
    
    <a href="http://codepen.io/hiluluke" target="_blank">
      <div class="item">
        <i class="i-codepen"></i>
      </div>
    </a>
    
  </div>
  
</aside>
    <div class="wrap">
      <div class="side">
  <div class="top" id="back-top"></div>
  <div class="arrows" id="nav-btn"></div>
</div>
      <header class="header">
  <a href="/">首页</a>
  <a href="/archives">日志</a>
  <a href="/categories">分类</a>
  <a href="/tags">标签</a>
  <a href="/atom.xml">RSS</a>
</header>
      <section id="main" class="content">
        
<div class="archives-wrap">
  <div class="archives">
    <div class="title-wrap">
      <h1>记一次首屏优化 </h1>
      <div class="page-info">
      
        <span>By <a href="/about">Hilu Luke</a> on</span>
      
        <time datetime="2016-01-15T16:00:00.000Z" itemprop="datePublished">Jan 16 2016</time>
      </div>
    </div>
    <div class="content-wrap">
    <p>在之前一段时间看了个首屏优化细节的文章，然后在自己项目里实际操作了下。</p>
<p>现在的业务逻辑涉及移动端支付，所以第一个需要考虑的就是首屏时间，如果首屏时间过长，用户体检是十分差的。其实就做了很简单一件事，在移动端将涉及页面渲染的样式表写成了内联样式。</p>
<p>大家都知道，请求了html之后才回根据html里面的链接去请求相应的样式，图片，视屏种种。而首屏时间就是将涉及页面渲染的种种全部加载完毕，浏览器render完毕之后的时间。这里也就能够理解要将样式表写在head里面，而把js写在<code>&lt;/body&gt;</code>之前的原因了。因为css涉及页面渲染，而js大多是业务逻辑，大多数不涉及页面渲染，所以完全可以把js的解析放在页面渲染之后。当然，你也注意到，大多数js不涉及页面渲染，而少数js也涉及页面渲染的，这时候可以把js放在<code>&lt;body&gt;</code>后面，另外这里也要注意，dom节点可能还没有生成，所以操作上一般是在<code>&lt;body&gt;</code>上加class，然后配合css的子父选择器。</p>
<a id="more"></a>
<p>回到本文，我们需要见降低首屏时间。我在chrome调试工具下发现，再加载html之后再去请求css带来的时间上的延迟是很大的。所以尝试了下，将css压缩之后内联在html里面。结果如下：</p>
<p>之前的加载时间：</p>
<p><img src="http://7fvhwe.com1.z0.glb.clouddn.com/%E9%80%89%E5%8C%BA_038.png" alt="之前的加载时间"></p>
<p>写成内联后的加载时间：</p>
<p><img src="http://7fvhwe.com1.z0.glb.clouddn.com/%E9%80%89%E5%8C%BA_037.png" alt="之后的加载时间"></p>
<p>上面的网络状态都是在3g网络状态下。</p>
<p>多次测试下，时间节约约一半。</p>
<p>这样做的坏处：</p>
<ul>
<li>不易维护，可以想象在html里面放一段压缩过后的css代码，是件多么恶心的事。不过在移动端感觉影响不大，样式表不会太大。</li>
<li>将css内联到html中的繁重操作，如果能自动化久好了。</li>
</ul>
<p>针对上面的问题，只要有一个工具能将样式表主动替换就好了，我去npm找了下。只找到一个将gulp插件将样式写成行内的，这完全是个不可逆的过程了。所以最后也没有使用。</p>
<p>所以现在尝试去自己写写gulp插件，看能不能满足自己需求。</p>

    </div>
  </div>
</div>


  <div class="ds-thread" data-thread-key="2016/01/16/first-screen/" data-title="记一次首屏优化" data-url="http://hiluluke.cn/2016/01/16/first-screen/">
    </div>


      </section>
    <footer style="text-align:center">
  啦啦啦，主题搭建中。。。
</footer>
    </div>
  </div>
  <script src="/js/simple_build.js"></script>
  
    <script type="text/javascript">
  var duoshuoQuery = {short_name:"hiluluke"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
  
</body>
</html>