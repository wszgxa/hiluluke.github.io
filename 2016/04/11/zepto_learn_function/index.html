<!DOCTYPE html>
<html>
  <head>
    
    <title>zepto源码学习 &lt;small&gt;插件方法&lt;/small&gt; | hilu&#39;s note</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="utf-8">
    <link rel="alternate" href="/atom.xml" title="hilu&#39;s note" type="application/atom+xml">
    
    <link rel="icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">
  </head>
<body>
  <script type="text/javascript">
    // fix sidebar flashing
    (function(){
      if (localStorage.getItem('sidebarState') == 'true') {
        document.body.className="sideShow"
      }
    })()
  </script>
  <div id="container">
    <aside class="sidebar">
  <div class="head-icon">
  
    <a href="/about">
      <img src="/avatar.jpeg">
    </a>
  
  </div>
  <div class="name">hiluluke</div>
  <div class="desc">
    <h4>我是一个粉刷匠</h4>  
  </div>
  <nav class="side-nav">
    <div class="nav-item">
      <a href="/archives">
        <span>
          26
        </span>
        <span>日志</span>
      </a>
    </div>
    <div class="nav-item">
      <a href="/categories">
        <span>
          7
        </span>
        <span>分类</span>
      </a>
    </div>
    <div class="nav-item">
      <a href="/tags">
        <span>
          22
        </span>
        <span>标签</span>
      </a>
    </div>
  </nav>
  
  <div class="social-wrap">
    
    <a href="https://github.com/wszgxa" target="_blank">
      <div class="item">
        <i class="i-github"></i>
      </div>
    </a>
    
    <a href="http://v2ex.com/member/hiluluke" target="_blank">
      <div class="item">
        <i class="i-v2ex"></i>
      </div>
    </a>
    
    <a href="https://www.zhihu.com/people/zhao-guo-xu" target="_blank">
      <div class="item">
        <i class="i-zhihu"></i>
      </div>
    </a>
    
    <a href="https://twitter.com/Hiluluke" target="_blank">
      <div class="item">
        <i class="i-twitter"></i>
      </div>
    </a>
    
    <a href="http://codepen.io/hiluluke" target="_blank">
      <div class="item">
        <i class="i-codepen"></i>
      </div>
    </a>
    
  </div>
  
</aside>
    <div class="wrap">
      <header class="header">
  <div class="arrows" id="nav-btn"></div>
</header>
      <section id="main" class="content">
        <section class="archives-wrap">
  <div class="archives">
    <div class="title-wrap">
      <h1>zepto源码学习 <small>插件方法</small></h1>
      <div class="page-info">
      
        <span>By <a href="/about">Hilu Luke</a> on</span>
      
        <time datetime="2016-04-10T16:00:00.000Z" itemprop="datePublished">Apr 11 2016</time>
      </div>
    </div>
    <div class="content-wrap">
    <h2 id="extend"><a href="#extend" class="headerlink" title="$.extend"></a>$.extend</h2><ul>
<li><p>用途<br>扩展对象属性。<br>第一个参数如果是true就递归的将source给target。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$.extend(target, [source, [source2, ...]])  ⇒ target</div><div class="line">$.extend(<span class="literal">true</span>, target, [source, ...])  ⇒ target v1<span class="number">.0</span>+</div></pre></td></tr></table></figure>
</li>
<li><p>相关代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">target, source, deep</span>) </span>&#123;</div><div class="line">  <span class="keyword">for</span> (key <span class="keyword">in</span> source)</div><div class="line">    <span class="keyword">if</span> (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123;</div><div class="line">      <span class="keyword">if</span> (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key]))</div><div class="line">        target[key] = &#123;&#125;</div><div class="line">      <span class="keyword">if</span> (isArray(source[key]) &amp;&amp; !isArray(target[key]))</div><div class="line">        target[key] = []</div><div class="line">      extend(target[key], source[key], deep)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) target[key] = source[key]</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Copy all but undefined properties from one or more</span></div><div class="line"><span class="comment">// objects to the `target` object.</span></div><div class="line">$.extend = <span class="function"><span class="keyword">function</span>(<span class="params">target</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> deep, args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">'boolean'</span>) &#123;</div><div class="line">    deep = target</div><div class="line">    target = args.shift()</div><div class="line">  &#125;</div><div class="line">  args.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>)</span>&#123; extend(target, arg, deep) &#125;)</div><div class="line">  <span class="keyword">return</span> target</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<a id="more"></a>
<h2 id="zepto-qsa"><a href="#zepto-qsa" class="headerlink" title="zepto.qsa"></a>zepto.qsa</h2><ul>
<li><p>用途<br>Css 选择器，主要是用<code>document.querySelectAll</code>，另外正对一些特殊的css选择做了优化比如”#id”。<br>他是一个内部方法，但是通过$.zepto暴露了出来，可以在插件中改写他。</p>
</li>
<li><p>代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">zepto.qsa = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> found,</div><div class="line">      maybeID = selector[<span class="number">0</span>] == <span class="string">'#'</span>,</div><div class="line">      maybeClass = !maybeID &amp;&amp; selector[<span class="number">0</span>] == <span class="string">'.'</span>,</div><div class="line">      nameOnly = maybeID || maybeClass ? selector.slice(<span class="number">1</span>) : selector, <span class="comment">// Ensure that a 1 char tag name still gets checked</span></div><div class="line">      isSimple = simpleSelectorRE.test(nameOnly)</div><div class="line">  <span class="keyword">return</span> (element.getElementById &amp;&amp; isSimple &amp;&amp; maybeID) ? <span class="comment">// Safari DocumentFragment doesn't have getElementById</span></div><div class="line">    ( (found = element.getElementById(nameOnly)) ? [found] : [] ) :</div><div class="line">    (element.nodeType !== <span class="number">1</span> &amp;&amp; element.nodeType !== <span class="number">9</span> &amp;&amp; element.nodeType !== <span class="number">11</span>) ? [] :</div><div class="line">    slice.call(</div><div class="line">      isSimple &amp;&amp; !maybeID &amp;&amp; element.getElementsByClassName ? <span class="comment">// DocumentFragment doesn't have getElementsByClassName/TagName</span></div><div class="line">        maybeClass ? element.getElementsByClassName(nameOnly) : <span class="comment">// If it's simple, it could be a class</span></div><div class="line">        element.getElementsByTagName(selector) : <span class="comment">// Or a tag</span></div><div class="line">        element.querySelectorAll(selector) <span class="comment">// Or it's not simple, and we need to query all</span></div><div class="line">    )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面有判断是不是含有id选择器，并用不同的选择方式，这样做主要是提高性能。上面的<code>simpleSelectorRE = /^[\w-]*$/</code>,用来看是否是在没有子css选择器的简单选择器。return里面有多层判断用来，选择最好的选择器。</p>
</li>
</ul>
<h2 id="fn-concat（带fn的都是绑定在fn上的）"><a href="#fn-concat（带fn的都是绑定在fn上的）" class="headerlink" title="$.fn.concat（带fn的都是绑定在fn上的）"></a>$.fn.concat（带fn的都是绑定在fn上的）</h2><ul>
<li><p>用途<br>这个方法只有zepto有，jq没有。把把后面的参数加在第一个参数数组里面。数组和类数组一样的都会一样的操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">concat(nodes, [node2, ...])  ⇒ self</div></pre></td></tr></table></figure>
</li>
<li><p>代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">concat: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> i, value, args = []</div><div class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</div><div class="line">    value = <span class="built_in">arguments</span>[i]</div><div class="line">    args[i] = zepto.isZ(value) ? value.toArray() : value</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> concat.apply(zepto.isZ(<span class="keyword">this</span>) ? <span class="keyword">this</span>.toArray() : <span class="keyword">this</span>, args)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面有判断调用对象是不是zepto对象，是的话就把他的dom元素取出来放数组里面。其中concat.apply中的concat是<code>concat = emptyArray.concat</code>空数组的原生方法。</p>
</li>
</ul>
<h2 id="map"><a href="#map" class="headerlink" title="$.map"></a>$.map</h2><ul>
<li><p>用途<br>循环遍历传入元素，回调函数判断一波，然后返回正确的数组。<br>*代码  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$.map = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> value, values = [], i, key</div><div class="line">  <span class="keyword">if</span> (likeArray(elements))</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</div><div class="line">      value = callback(elements[i], i)</div><div class="line">      <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value)</div><div class="line">    &#125;</div><div class="line">  <span class="keyword">else</span></div><div class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> elements) &#123;</div><div class="line">      value = callback(elements[key], key)</div><div class="line">      <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value)</div><div class="line">    &#125;</div><div class="line">  <span class="keyword">return</span> flatten(values)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中有个flatten,他是一个私有方法，主要作用就是将数组中的zepto对象元素的dom元素取出来放数组里面。</p>
</li>
</ul>
<h2 id="each-fn-each-在fn和-上都有这个方法，用法不一样"><a href="#each-fn-each-在fn和-上都有这个方法，用法不一样" class="headerlink" title="$.each $.fn.each (在fn和$上都有这个方法，用法不一样)"></a>$.each $.fn.each (在fn和$上都有这个方法，用法不一样)</h2><ul>
<li><p>用途<br>遍历元素，这里可以遍历一个数组或者就是zepto对象，当回调函数返回<code>false</code>的时候停止遍历。<br>两种用法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'form input'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'input %d is: %o'</span>, index, <span class="keyword">this</span>);</div><div class="line">&#125;)</div><div class="line">$.each([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], <span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'input %d is: %o'</span>, index, <span class="keyword">this</span>);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$.each = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> i, key</div><div class="line">  <span class="keyword">if</span> (likeArray(elements)) &#123;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++)</div><div class="line">      <span class="keyword">if</span> (callback.call(elements[i], i, elements[i]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</div><div class="line">      <span class="keyword">if</span> (callback.call(elements[key], key, elements[key]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> elements</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面这个是定义在fn上面的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</div><div class="line">    emptyArray.every.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, idx</span>)</span>&#123;</div><div class="line">      <span class="keyword">return</span> callback.call(el, idx, el) !== <span class="literal">false</span></div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>当是一个类数组调用时用$上的方法，当是zepto对象调用的时候用fn上的方法。</p>
</li>
</ul>

    </div>
  </div>
</section>
      </section>
    </div>
    <footer style="text-align:center">
  啦啦啦，主题搭建中。。。
</footer>
  </div>
  <script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
  <script src="/js/script.js"></script>
</body>
</html>