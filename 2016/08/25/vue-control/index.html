<!DOCTYPE html><html><head><meta charset="utf-8"><link rel="dns-prefetch" href="//7fvhwe.com1.z0.glb.clouddn.com/"><link rel="dns-prefetch" href="//static.duoshuo.com/"><link rel="dns-prefetch" href="//hm.baidu.com/"><link rel="dns-prefetch" href="//www.google-analytics.com/"><link rel="dns-prefetch" href="//tajs.qq.com/"><title> 使用Vue快速开发单页应用 | 功能组件与子路由组件</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="alternate" href="" title="hilu&#39;s note" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><style>.menu-home .menu-item-home{color:#b71c1c}.menu-categories .menu-item-categories{color:#b71c1c}.menu-tags .menu-item-tags{color:#b71c1c}.menu-about .menu-item-about{color:#b71c1c}.menu-rss .menu-item-rss{color:#b71c1c}</style><link rel="stylesheet" href="/css/style.css"></head><body><script type="text/javascript">!function(){"true"==localStorage.getItem("sidebarState")&&(document.body.className="sideShow")}()</script><div id="container"><aside class="sidebar"><div class="head-icon"> <a href="/about"><img src="/avatar.jpeg"></a></div><div class="name">hiluluke</div><div class="desc"><h4>我是一个粉刷匠</h4></div><nav class="side-nav"><div class="nav-item"> <a href="/"><span>30</span> <span>日志</span></a></div><div class="nav-item"> <a href="/categories"><span>7</span> <span>分类</span></a></div><div class="nav-item"> <a href="/tags"><span>22</span> <span>标签</span></a></div></nav><div class="social-wrap"><a href="https://github.com/wszgxa" target="_blank"><div class="item"><i class="i-github"></i></div></a><a href="http://v2ex.com/member/hiluluke" target="_blank"><div class="item"><i class="i-v2ex"></i></div></a><a href="https://www.zhihu.com/people/zhao-guo-xu" target="_blank"><div class="item"><i class="i-zhihu"></i></div></a><a href="https://twitter.com/Hiluluke" target="_blank"><div class="item"><i class="i-twitter"></i></div></a><a href="http://codepen.io/hiluluke" target="_blank"><div class="item"><i class="i-codepen"></i></div></a></div></aside><div class="wrap"><div class="side"><div class="top" id="back-top"></div><div class="arrows" id="nav-btn"></div></div><header class="header menu-2016"><nav> <a class="menu-item-home" href="/">首页</a> <a class="menu-item-categories" href="/categories">分类</a> <a class="menu-item-tags" href="/tags">标签</a> <a class="menu-item-about" href="/about">关于</a> <a class="menu-item-rss" href="/atom.xml">RSS</a></nav></header><section id="main" class="content"><div class="archives-wrap"><div class="archives"><div class="title-wrap"><h1>使用Vue快速开发单页应用 <small>功能组件与子路由组件</small></h1><div class="page-info"> <span>By <a href="/about">hiluluke</a> on</span> <time datetime="2016-08-24T16:00:00.000Z" itemprop="datePublished">Aug 25 2016</time></div></div><div class="content-wrap"><blockquote><p>本文所涉及代码全在<a href="https://github.com/wszgxa/vue-cnode" target="_blank" rel="external">vue-cnode</a></p></blockquote><p><img src="https://segmentfault.com/image?src=http://7fvhwe.com1.z0.glb.clouddn.com/fileStruct.png&amp;objectId=1190000006711743&amp;token=2a95eb1caab2bdfd1b495e76acce1574" alt="文件结构"></p><p>上图是我们demo项目的整体结构，我们可以看见在第三级有三个东西router,全局组件，功能组件。其中全局组件和功能组件是脱离于router的，因为这两部分是所有逻辑组件共有的。我们将他提出来，放在App.vue里面而不是放在router下面的路由组件中，是为了只引用一次然后全局调用。</p><p>但是，具体的路由逻辑组件需要展现的全局组件内容是不一样的，需要功能组件交互的内容也不一样，所以需要在不同的路由逻辑组件中对全局组件和功能组件进行控制。</p><p>本文就是介绍如何通过vuex对全局组件和功能组件进行控制的。</p><a id="more"></a><h2 id="使用vuex传递逻辑数据"><a href="#使用vuex传递逻辑数据" class="headerlink" title="使用vuex传递逻辑数据"></a>使用vuex传递逻辑数据</h2><p>说是控制，其实就是组件间交互，vue中组件交互有很多我方式，我们这里用vuex。</p><p>我们将单独建立一个module(doc_state)，用来做功能组件和全局组件的功能交互，在module中我们将建立功能组件或则全局组件需要的数据，和函数方法等。如下图所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// doc state 需要一些变量来记录文档状态</div><div class="line">import &#123;</div><div class="line">  SET_TIP</div><div class="line">&#125; from &apos;../mutation_types&apos;</div><div class="line">const state = &#123;</div><div class="line">  tip: &#123;</div><div class="line">    text: &apos;&apos;,</div><div class="line">    time: 2000,</div><div class="line">    callback: null</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">const mutations = &#123;</div><div class="line">  [SET_TIP] (state, tip) &#123;</div><div class="line">    state.tip = tip</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">export default &#123;</div><div class="line">  state,</div><div class="line">  mutations</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这里我们以tip（提示）组件为例子讲解，所有doc modules在<code>/src/vuex/modules/doc_state</code>。</p><p>然后我们定义doc_actions定义我们的action:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">import * as types from &apos;../mutation_types&apos;</div><div class="line"></div><div class="line">export const setTip = (&#123;dispatch&#125;, tip) =&gt; &#123;</div><div class="line">  if (!tip.time) tip.time = 2000 // 默认tip展现时间</div><div class="line">  dispatch(types.SET_TIP, tip)</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>actions，会在路由逻辑组件中引用，调用action就能控制我们的tip组件。</p><p>再把 doc_state挂载到store.js就可以了～</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">import docState from &apos;./modules/doc_state&apos;</div><div class="line">export default new Vuex.Store(&#123;</div><div class="line">  modules: &#123;</div><div class="line">    docState,</div><div class="line">    content,</div><div class="line">    userInfo</div><div class="line">  &#125;,</div><div class="line">  strict: debug,</div><div class="line">  middlewares: debug ? [] : []</div><div class="line">&#125;)</div></pre></td></tr></table></figure><h2 id="tip组件"><a href="#tip组件" class="headerlink" title="tip组件"></a>tip组件</h2><p>在我们的common文件夹里面新建一个tip.vue。他就是我们的提示信息组件。（路径<code>/src/components/common/tip.vue</code>）</p><p>首先我们需要获取tip在vuex里面的数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vuex: &#123;</div><div class="line">  getters: &#123;</div><div class="line">    tip: (&#123; docState &#125;) =&gt; docState.tip</div><div class="line">  &#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure><p>然后就是具体的逻辑了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">data () &#123;</div><div class="line">  return &#123;</div><div class="line">    tipVisible: false</div><div class="line">  &#125;</div><div class="line">&#125;,</div><div class="line">watch: &#123;</div><div class="line">  tip: &apos;tipShow&apos;</div><div class="line">&#125;,</div><div class="line">methods: &#123;</div><div class="line">  tipShow () &#123;</div><div class="line">    let self = this</div><div class="line">    self.tipVisible = true</div><div class="line">    setTimeout(function () &#123;</div><div class="line">      self.tipVisible = false</div><div class="line">      if (self.tip.callback) &#123;</div><div class="line">        self.tip.callback()</div><div class="line">      &#125;</div><div class="line">    &#125;, self.tip.time)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>上面的tipVisible是我们用来控制控制展示的变量，在template里面：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"tipVisible"</span> <span class="attr">class</span>=<span class="string">"tip"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tip-wrap"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; tip.text &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div></pre></td></tr></table></figure><p></p><p>tip组件一共做了三件事：</p><ol><li>监听vuex获取的tip变量，在tip变量改变时执行tipShow方法。</li><li>展示信息</li><li>展示时间结束后，执行回调函数（如果有）</li></ol><p>上面就完成了tip组件的整套逻辑，最后我们还需要把tip组件挂在App.vue。</p><p>template:<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">cn-header</span>&gt;</span><span class="tag">&lt;/<span class="name">cn-header</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">sidebar</span>&gt;</span><span class="tag">&lt;/<span class="name">sidebar</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">tip</span>&gt;</span><span class="tag">&lt;/<span class="name">tip</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">loading</span>&gt;</span><span class="tag">&lt;/<span class="name">loading</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div></pre></td></tr></table></figure><p></p><p>js:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> tip <span class="keyword">from</span> <span class="string">'./components/common/tip'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  components: &#123;</div><div class="line">    tip,</div><div class="line">  &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>这样我们就能在所有路由逻辑组件调用了。</p><h2 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h2><p>拿<a href="http://hiluluke.cn/2016/08/20/vue-first/">登录组件</a>作为例子。</p><p>首先我们需要引入action:<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">import &#123; setMenu, setTip &#125; from &apos;../../vuex/actions/doc_actions&apos;</div><div class="line">export default &#123;</div><div class="line">  vuex: &#123;</div><div class="line">    actions: &#123;</div><div class="line">      setTip,</div><div class="line">      setDetail</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>我们在登录出错的时候会给用户提示信息：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.setBaseInfo(<span class="keyword">this</span>.access, (res) =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (res.success) &#123;</div><div class="line">    <span class="keyword">this</span>.success()</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">this</span>.setTip(&#123;</div><div class="line">    text: res.msg</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure><p>只要调用<code>this.setTip</code>方法就可以了。是不是很简单？组件写好后，后面大家再使用就只需调用这一个方法。</p><p><em>注意</em><br>这里需要主要传入回调函数的this的指向。建议这样：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.setTip(&#123;</div><div class="line">  text: <span class="string">'lala'</span>,</div><div class="line">  callback: () =&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.xxx()</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure><p>箭头函数有个作用就是会绑定它声明地方的this。这样我们就可以在callback里面调用当前组件的方法了。不用箭头函数，bind一下也是可以的～</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>你可以发现我们的组件交互完全是通过数据去控制的。在搭建功能组件和vuex的module时会复杂一点，但是逻辑更清晰，我们在debug时候也更方便。在子组件调用时也非常的简单，就相当提供了一个接口。</p></div></div></div><div class="ds-thread" data-thread-key="2016/08/25/vue-control/" data-title="使用Vue快速开发单页应用" data-url="http://hiluluke.cn/2016/08/25/vue-control/"></div></section><footer class="footer"><div>我是一个粉刷匠</div><div>由 <a href="https://hexo.io/">Hexo</a> 强力驱动 | 主题- <a href="https://github.com/wszgxa/hexo-theme-simple">Simple</a></div></footer></div></div><script src="/js/simple_build.js"></script><script type="text/javascript">var duoshuoQuery={short_name:"hiluluke"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-83014983-1","auto"),ga("send","pageview")</script></body></html>