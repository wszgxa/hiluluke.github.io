<!DOCTYPE html>
<html>
  <head>
    
    <title>使用Vue快速开发单页应用|vue-router | hilu&#39;s note</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="utf-8">
    <link rel="alternate" href="/atom.xml" title="hilu&#39;s note" type="application/atom+xml">
    
    <link rel="icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">
  </head>
<body>
  <script type="text/javascript">
    // fix sidebar flashing
    (function(){
      if (localStorage.getItem('sidebarState') == 'true') {
        document.body.className="sideShow"
      }
    })()
  </script>
  <div id="container">
    <aside class="sidebar">
  <div class="head-icon">
  
    <a href="/about">
      <img src="/avatar.jpeg">
    </a>
  
  </div>
  <div class="name">hiluluke</div>
  <div class="desc">
    <h4>我是一个粉刷匠</h4>  
  </div>
  <nav class="side-nav">
    <div class="nav-item">
      <a href="/archives">
        <span>
          26
        </span>
        <span>日志</span>
      </a>
    </div>
    <div class="nav-item">
      <a href="/categories">
        <span>
          7
        </span>
        <span>分类</span>
      </a>
    </div>
    <div class="nav-item">
      <a href="/tags">
        <span>
          22
        </span>
        <span>标签</span>
      </a>
    </div>
  </nav>
  
  <div class="social-wrap">
    
    <a href="https://github.com/wszgxa" target="_blank">
      <div class="item">
        <i class="i-github"></i>
      </div>
    </a>
    
    <a href="http://v2ex.com/member/hiluluke" target="_blank">
      <div class="item">
        <i class="i-v2ex"></i>
      </div>
    </a>
    
    <a href="https://www.zhihu.com/people/zhao-guo-xu" target="_blank">
      <div class="item">
        <i class="i-zhihu"></i>
      </div>
    </a>
    
    <a href="https://twitter.com/Hiluluke" target="_blank">
      <div class="item">
        <i class="i-twitter"></i>
      </div>
    </a>
    
    <a href="http://codepen.io/hiluluke" target="_blank">
      <div class="item">
        <i class="i-codepen"></i>
      </div>
    </a>
    
  </div>
  
</aside>
    <div class="wrap">
      <header class="header">
  <div class="arrows" id="nav-btn"></div>
</header>
      <section id="main" class="content">
        <section class="archives-wrap">
  <div class="archives">
    <div class="title-wrap">
      <h1>使用Vue快速开发单页应用|vue-router</h1>
      <div class="page-info">
      
        <span>By <a href="/about">Hilu Luke</a> on</span>
      
        <time datetime="2016-08-04T16:00:00.000Z" itemprop="datePublished">Aug 5 2016</time>
      </div>
    </div>
    <div class="content-wrap">
    <blockquote>
<p>本文所涉及代码全在<a href="https://github.com/wszgxa/vue-cnode" target="_blank" rel="external">vue-cnode</a></p>
</blockquote>
<p>vue-router主要作用是将路由控制，转移到前端。我们将会在vue-router里面保存一个路由表，在vue中具体通过调用提供的指令或则方法进行跳转。</p>
<p>其实吧，vue-router说白了就是一个插件，对外暴露的也就是指令和方法。如果只要求灵活用起来，我们需要学习的也就3个地方：</p>
<ul>
<li>配置路由</li>
<li>指令</li>
<li>方法</li>
</ul>
<h2 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h2><p>路由配置其实是分两步的，第一步把vue-router的指令方法挂到Vue实例，第二步才是添加路由配置上。下面是基本的路由配置：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></div><div class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></div><div class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'App.vue'</span></div><div class="line">Vue.use(VueRouter) <span class="comment">// 第一步</span></div><div class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</div><div class="line">  history: <span class="literal">true</span>,</div><div class="line">  saveScrollPosition: <span class="literal">true</span></div><div class="line">&#125;) <span class="comment">// 第二步</span></div><div class="line">router.map(&#123;</div><div class="line">    <span class="string">'/'</span>: &#123;</div><div class="line">      name: <span class="string">'index'</span>,</div><div class="line">      title: <span class="string">'全部'</span>,</div><div class="line">      component: (resolve) =&gt; <span class="built_in">require</span>([<span class="string">'./components/main/index.vue'</span>], resolve)</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'/good'</span>: &#123;</div><div class="line">      name: <span class="string">'good'</span>,</div><div class="line">      title: <span class="string">'精华'</span>,</div><div class="line">      component: (resolve) =&gt; <span class="built_in">require</span>([<span class="string">'./components/main/index.vue'</span>], resolve)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">router.start(App, <span class="string">'#app'</span>)</div></pre></td></tr></table></figure></p>
<p>这里大家可以去看看源码，源码很简洁。主要就是声明了一个Router的对象，Router上面插件要的install方法，然后还有start方法。</p>
<p>源码片段<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span> (&#123;</div><div class="line">    hashbang = <span class="literal">true</span>,</div><div class="line">    abstract = <span class="literal">false</span>,</div><div class="line">    history = <span class="literal">false</span>,</div><div class="line">    saveScrollPosition = <span class="literal">false</span>,</div><div class="line">    transitionOnLoad = <span class="literal">false</span>,</div><div class="line">    suppressTransitionError = <span class="literal">false</span>,</div><div class="line">    root = <span class="literal">null</span>,</div><div class="line">    linkActiveClass = <span class="string">'v-link-active'</span></div><div class="line">  &#125; = &#123;&#125;) &#123;</div><div class="line">    ....</div><div class="line">  &#125;</div><div class="line">Router.install = <span class="function"><span class="keyword">function</span> (<span class="params">externalVue</span>) </span>&#123;</div><div class="line">  ....</div><div class="line">  Vue = externalVue</div><div class="line">  applyOverride(Vue)</div><div class="line">  View(Vue)</div><div class="line">  Link(Vue)</div><div class="line">  util.Vue = Vue</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>源码中在Router一共有9个方法：</p>
<ul>
<li>map</li>
<li>on</li>
<li>redirect</li>
<li>alias</li>
<li>beforeEach</li>
<li>afterEach</li>
<li>go</li>
<li>replace</li>
<li>start</li>
<li>stop</li>
</ul>
<p>其中start是初始化组件的，</p>
<p>其中涉及路由前期配置的是：map, redirect，alias，beforeEach，afterEach，start。go和replace两个方法都是路由跳转的。</p>
<p>map，redirect，alias这3个方法是基础的配置方法，很简单，就请看<a href="http://router.vuejs.org/zh-cn/index.html" target="_blank" rel="external">文档</a>吧。</p>
<p>这里主要讲下beforeEach和afterEach，就和方法名一样他们分别是在路由跳转前后做的一些事情。</p>
<p>在vue-router有一个路由声明周期的概念，这里不展开来讲，你只需要知道我们berforeEach和afterEach后面接的函数是一个钩子函数，钩子函数接受的第一个参数是一个transition对象,transition对象有以下方法，主要是用来控制路由跳转的。</p>
<ul>
<li>transition.to 一个我们将要跳转去的路由的对象，这个对象可能有path,name等属性。</li>
<li>transition.from 当前路由对象</li>
<li>transition.next() 调用此函数处理切换过程的下一步</li>
<li>transition.abort([reason]) 终止切换</li>
<li>transition.redirect(path) 重定向到另一个路由</li>
</ul>
<p>afterEach由于是路由切换后，只有上面的to,from两个属性。</p>
<p>为什么要单独讲beforEach和afterEach，因为我们可以在里面做很多全局的东西。比如登陆跳转、文章切换title、特定页面设置属性、调用vuex的方法等。这里我们讲一个刷新title的例子。后续还会有一个全局控制的文章，再补充些其他例子。</p>
<p>单页应用由于只有一次</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">router.map(&#123;</div><div class="line">    <span class="string">'/'</span>: &#123;</div><div class="line">      name: <span class="string">'index'</span>,</div><div class="line">      title: <span class="string">'全部'</span>,</div><div class="line">      component: (resolve) =&gt; <span class="built_in">require</span>([<span class="string">'./components/main/index.vue'</span>], resolve)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// document title change</span></div><div class="line">  router.afterEach((transition) =&gt; &#123;</div><div class="line">    <span class="built_in">document</span>.title = transition.to.title || <span class="string">'CNode.js'</span></div><div class="line">  &#125;)</div></pre></td></tr></table></figure>

    </div>
  </div>
</section>
      </section>
    </div>
    <footer style="text-align:center">
  啦啦啦，主题搭建中。。。
</footer>
  </div>
  <script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
  <script src="/js/script.js"></script>
</body>
</html>