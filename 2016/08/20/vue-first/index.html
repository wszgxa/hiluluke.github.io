<!DOCTYPE html><html><head><meta charset="utf-8"><link rel="dns-prefetch" href="//7fvhwe.com1.z0.glb.clouddn.com/"><link rel="dns-prefetch" href="//static.duoshuo.com/"><link rel="dns-prefetch" href="//www.google-analytics.com/"><title> 使用Vue快速开发单页应用 | 登录页面</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="alternate" href="" title="hilu&#39;s note" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><style>.menu-home .menu-item-home{color:#b71c1c}.menu-categories .menu-item-categories{color:#b71c1c}.menu-tags .menu-item-tags{color:#b71c1c}.menu-about .menu-item-about{color:#b71c1c}.menu-rss .menu-item-rss{color:#b71c1c}</style><style>blockquote,body,button,dd,dl,dt,fieldset,form,h1,h2,h3,h4,h5,h6,hr,input,legend,li,ol,p,pre,td,textarea,th,ul{margin:0;padding:0}.wrap,body{position:relative}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:100%}address,cite,dfn,em,i,var{font-style:normal}code,kbd,pre,samp{font-family:courier new,courier,monospace}small{font-size:16px}ol,ul{list-style:none}a{text-decoration:none}.archives .content-wrap a:hover,.cate-list a:hover,.content .gist .gist-file .gist-meta a:hover,.footer a:hover{text-decoration:underline}fieldset,img{border:0}input,select{-webkit-tap-highlight-color:transparent}@-moz-keyframes flow{from{transform:translate3d(0,-30px,0);opacity:0}to{transform:translate3d(0,0,0);opacity:1}}@-webkit-keyframes flow{from{transform:translate3d(0,-30px,0);opacity:0}to{transform:translate3d(0,0,0);opacity:1}}@-o-keyframes flow{from{transform:translate3d(0,-30px,0);opacity:0}to{transform:translate3d(0,0,0);opacity:1}}@keyframes flow{from{transform:translate3d(0,-30px,0);opacity:0}to{transform:translate3d(0,0,0);opacity:1}}body,html{height:100%}html{-webkit-overflow-scrolling:touch;-webkit-text-size-adjust:100%}body{word-break:break-all;word-wrap:break-word;font-size:1em;line-height:1.5;font-family:"Lantinghei SC","Open Sans",Arial,"Hiragino Sans GB","Microsoft YaHei",STHeiti,"WenQuanYi Micro Hei",SimSun,Helvetica,sans-serif;background:#fefefe;color:#323232}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_1469071762_054906.eot);src:url(//at.alicdn.com/t/font_1469071762_054906.eot?#iefix) format('embedded-opentype'),url(//at.alicdn.com/t/font_1469071762_054906.woff) format('woff'),url(//at.alicdn.com/t/font_1469071762_054906.ttf) format('truetype'),url(//at.alicdn.com/t/font_1469071762_054906.svg#iconfont) format('svg')}.i-codepen,.i-douban,.i-facebook,.i-github,.i-left,.i-next,.i-right,.i-twitter,.i-v2ex,.i-weibo,.i-zhihu{font-family:iconfont;font-size:18px;font-style:normal;color:#616171}.i-weibo::after{content:'\e607'}.i-github::after{content:'\e60a'}.i-v2ex::after{content:'\e606'}.i-douban::after{content:'\e605'}.i-zhihu::after{content:'\e608'}.i-twitter::after{content:'\e609'}.i-facebook::after{content:'\e60b'}.i-codepen::after{content:'\e601'}.i-left::after{content:'\e600'}.i-right::after{content:'\e602'}.i-next::after{content:'\e603'}.wrap{transition:.3s all ease-in-out}.side,.sidebar{position:fixed}.header{max-width:840px;margin:0 auto 20px;text-align:center;background-color:#fff;box-shadow:0 1px 3px #e3e3e3;-webkit-box-shadow:0 1px 3px #e3e3e3;-moz-box-shadow:0 1px 3px #e3e3e3;-ms-box-shadow:0 1px 3px #e3e3e3;-o-box-shadow:0 1px 3px #e3e3e3}.header a:hover,.side .arrows,.side .top{background-color:#e3e3e3}.header a{color:#323232;display:inline-block;padding:10px;transition:background-color .2s ease}.header .ac{color:#b71c1c}.side{bottom:40px;transition:.3s all}.side .arrows,.side .top{width:35px;height:35px;border:1px solid transparent;line-height:35px;text-align:center;cursor:pointer;border-radius:3px}.side .arrows:after,.side .top:after{content:'\e602';font-family:iconfont;font-size:16px;color:#323232}.sidebar .desc,.sidebar .name{font-size:15px;text-align:center}.side .arrows:hover:after,.side .top:hover:after{color:#b71c1c}.side .top{margin-bottom:1px;transform:rotate3d(0,0,1,-90deg);-webkit-transform:rotate3d(0,0,1,-90deg);-moz-transform:rotate3d(0,0,1,-90deg);-ms-transform:rotate3d(0,0,1,-90deg);-o-transform:rotate3d(0,0,1,-90deg)}.sideShow .arrows{transform:rotate3d(0,1,0,180deg);-webkit-transform:rotate3d(0,1,0,180deg);-moz-transform:rotate3d(0,1,0,180deg);-ms-transform:rotate3d(0,1,0,180deg);-o-transform:rotate3d(0,1,0,180deg)}.sideShow .side{transform:translate3d(2px,0,0);-webkit-transform:translate3d(2px,0,0);-moz-transform:translate3d(2px,0,0);-ms-transform:translate3d(2px,0,0);-o-transform:translate3d(2px,0,0)}.sideShow .wrap{padding-left:210px}.sideShow .sidebar{transform:none;-webkit-transform:none;-moz-transform:none;-ms-transform:none;-o-transform:none;box-shadow:1px 0 5px #ededed;-webkit-box-shadow:1px 0 5px #ededed;-moz-box-shadow:1px 0 5px #ededed;-ms-box-shadow:1px 0 5px #ededed;-o-box-shadow:1px 0 5px #ededed}.sidebar{left:0;top:0;bottom:0;z-index:2;width:210px;transform:translate3d(-210px,0,0);-webkit-transform:translate3d(-210px,0,0);-moz-transform:translate3d(-210px,0,0);-ms-transform:translate3d(-210px,0,0);-o-transform:translate3d(-210px,0,0);transition:transform .3s ease-in-out;background-color:#ededed}.sidebar .head-icon{margin:30px auto 10px;width:72px;height:72px}.sidebar .head-icon img{width:60px;height:60px;border:6px solid rgba(255,255,255,.85);border-radius:50%}.sidebar .desc{margin:0 auto;color:#707070;max-width:180px}.sidebar .name{color:#000;padding:0 0 10px}.sidebar .side-nav{margin-top:35px;text-align:center;font-size:16px}.sidebar .side-nav .nav-item{display:inline-block;padding:0 4px}.sidebar .side-nav .nav-item span{color:#616171;display:block;transition:.2s color}.sidebar .side-nav .nav-item:hover span,.sidebar .social-wrap .item:hover i{color:#000}.sidebar .side-nav .nav-item:nth-child(n+2){border-left:2px solid #e0e0e0}.sidebar .social-wrap{margin:30px auto 0;width:180px;text-align:center}.sidebar .social-wrap .item{padding:5px;display:inline-block;transition:.2s all ease-in-out}.sidebar .social-wrap .item:hover{background-color:#e3e3e3}.content{max-width:760px;min-height:768px;margin:0 auto;padding:20px 40px;background-color:#fff;box-shadow:0 1px 3px #e3e3e3;-webkit-box-shadow:0 1px 3px #e3e3e3;-moz-box-shadow:0 1px 3px #e3e3e3;-ms-box-shadow:0 1px 3px #e3e3e3;-o-box-shadow:0 1px 3px #e3e3e3}.archives{margin-bottom:50px;animation:flow 530ms ease-in-out}.archives .title-wrap{margin:20px 0;padding-bottom:10px;border-bottom:1px solid #e0e0e0}.archives .read-more a:hover,.archives .title-wrap .page-info a:hover{border-bottom:1px solid #1b1a1a}.archives .title-wrap h1{font-size:1.8em;color:#202020}.archives .title-wrap .post-title{position:relative;display:inline-block}.archives .title-wrap .post-title::before{content:'';bottom:0;width:100%;position:absolute;border-top:2px solid #1b1a1a;transform:scale3d(0,1,1);-webkit-transform:scale3d(0,1,1);-moz-transform:scale3d(0,1,1);-ms-transform:scale3d(0,1,1);-o-transform:scale3d(0,1,1);transition:transform .2s ease-in-out}.archives .title-wrap .post-title:hover::before{transform:scale3d(1,1,1);-webkit-transform:scale3d(1,1,1);-moz-transform:scale3d(1,1,1);-ms-transform:scale3d(1,1,1);-o-transform:scale3d(1,1,1)}.archives .title-wrap .page-info{font-size:16px;color:#616171}.archives .title-wrap .page-info a{color:#616171}.archives .read-more{text-align:left}.archives .read-more a{color:#202020;line-height:14px;transition:all .2s ease-in-out}.archives .read-more a:hover span{color:#000}.archives .read-more a span{font-size:14px}.archives .read-more a span::after{font-size:12px}.archives .content-wrap h1,.archives .content-wrap h2,.archives .content-wrap h3,.archives .content-wrap h4{color:#b71c1c;margin:1.5em 0 1em}.archives .content-wrap h1{font-size:1.75em}.archives .content-wrap h2{font-size:1.5em}.archives .content-wrap h3,.archives .content-wrap h4{font-size:1.1em}.archives .content-wrap blockquote{border-left:.3em solid #e0e0e0}.archives .content-wrap blockquote p{padding-left:.8em}.archives .content-wrap ul{padding-left:1.5em}.archives .content-wrap ul li{list-style:circle}.archives .content-wrap .code,.archives .content-wrap figure table{border:none}.archives .content-wrap p{margin:1em 0;text-align:justify}.archives .content-wrap img{display:block;max-width:90%;margin:0 auto;border:1px solid #e0e0e0}.archives .content-wrap a{color:#4078c0}.page-nav .current,.page-nav a{color:#616171}.archives .content-wrap table{max-width:80%;margin:0 auto;border:1px solid #ddd;border-spacing:0;border-collapse:collapse}.archives .content-wrap th{padding:8px;text-align:left;line-height:1.42857143;vertical-align:bottom;border:1px solid #ddd;border-bottom-width:2px;box-sizing:border-box}.cate-head,.ct-title,.footer,.page-nav,.tags-cloud{text-align:center}.archives .content-wrap td{border:1px solid #ddd;padding:8px;line-height:1.42857143;vertical-align:top}.page-nav .current,.page-nav .extend:hover,.page-nav .page-number:hover{border-bottom:1px solid #000}.page-nav{margin:40px 0}.page-nav .extend,.page-nav .page-number,.page-nav .space{position:relative;display:inline-block;width:30px;height:30px;margin:0 10px}.page-nav .page-number{text-align:center;font-size:16px;line-height:30px}.page-nav .extend{line-height:30px}.page-nav .extend i{font-size:12px}.ds-thread{width:96%;margin:0 auto}.content .highlight,.content pre{background:#fafafa;margin:1em auto;padding:10px;overflow:auto;color:#515151;line-height:1.5;white-space:pre;word-spacing:normal;word-break:normal}.content .gist .gist-file .gist-data .line-numbers{color:#666;font-size:.85em}.content code,.content pre{font-family:consolas,menlo,monospace}.content code{background:#fefefe;text-shadow:0 1px #fff;padding:0 .3em}.content pre code{background:0 0;text-shadow:none;padding:0}.content .highlight pre{border:none;margin:0;padding:0}.content .highlight table{margin:0;width:auto}.content .highlight td{border:none;padding:0}.content .highlight figcaption{font-size:.85em;color:#999;line-height:1em;margin-bottom:1em}.content .highlight figcaption a{float:right}.content .highlight .gutter pre{display:none}.content .highlight .line{height:1.5em}.content .highlight .line.marked{background:#515151}.content .gist{margin:0 -20px;border-style:solid;border-color:#e0e0e0;border-width:1px 0;background:#fafafa;padding:15px 20px 15px 0}.content .gist .gist-file{border:none;font-family:font-mono;margin:0}.content .gist .gist-file .gist-data{background:0 0;border:none}.content .gist .gist-file .gist-data .line-numbers{background:0 0;border:none;padding:0 20px 0 0}.content .gist .gist-file .gist-data .line-data{padding:0!important}.content .gist .gist-file .highlight{margin:0;padding:0;border:none}.content .gist .gist-file .gist-meta{background:#fafafa;color:#999;font:.85em font-sans;text-shadow:0 0;padding:0;margin-top:1em;margin-left:20px}.content .gist .gist-file .gist-meta a{color:color-link;font-weight:400}pre .comment,pre .title{color:#999}pre .attribute,pre .css .class,pre .css .id,pre .css .pseudo,pre .html .doctype,pre .regexp,pre .ruby .constant,pre .tag,pre .variable,pre .xml .doctype,pre .xml .pi,pre .xml .tag .title{color:#f2777a}pre .built_in,pre .constant,pre .literal,pre .number,pre .params,pre .preprocessor{color:#f99157}pre .class,pre .css .rules .attribute,pre .header,pre .inheritance,pre .ruby .class .title,pre .ruby .symbol,pre .string,pre .value,pre .xml .cdata{color:#9c9}pre .css .hexcolor{color:#6cc}pre .coffeescript .title,pre .function,pre .javascript .title,pre .perl .sub,pre .python .decorator,pre .python .title,pre .ruby .function .title,pre .ruby .title .keyword{color:#69c}pre .javascript .function,pre .keyword{color:#c9c}.cate-head{margin-top:20px;font-size:1.5em}.cate-list-item{display:inline-block;padding:0 8px}.cate-list{max-width:80%;margin:40px auto 0}.cate-list a{color:#323232;padding:5px}.cate-list span,.ct-title small{color:#616171}.cate-list span:before{content:'['}.cate-list span:after{content:']'}.tags-cloud{width:80%;margin:20px auto 0;text-indent:4px;word-break:normal}.tags-cloud a{display:inline-block;margin:5px}.tags-cloud a:hover{border-bottom:1px solid #e3e3e3}.ct-title{margin:10px auto 20px}.ct-title h2{font-size:1.75em}.footer{max-width:760px;margin:10px auto 0;background-color:#fff;box-shadow:0 0 5px #e3e3e3;-webkit-box-shadow:0 0 5px #e3e3e3;-moz-box-shadow:0 0 5px #e3e3e3;-ms-box-shadow:0 0 5px #e3e3e3;-o-box-shadow:0 0 5px #e3e3e3;padding:10px 40px}.footer a{color:#4078c0}.footer div{padding:5px}@media screen and (max-width:800px){.side{display:none}.content{padding:20px}.footer,.header{max-width:800px}.page-nav .page-number{width:25px;height:25px;line-height:25px}}</style></head><body><script type="text/javascript">!function(){"true"==localStorage.getItem("sidebarState")&&(document.body.className="sideShow")}()</script><div id="container"><aside class="sidebar"><div class="head-icon"> <a href="/about"><img src="/avatar.jpeg"></a></div><div class="name">hiluluke</div><div class="desc"><h4>我是一个粉刷匠</h4></div><nav class="side-nav"><div class="nav-item"> <a href="/"><span>32</span> <span>日志</span></a></div><div class="nav-item"> <a href="/categories"><span>8</span> <span>分类</span></a></div><div class="nav-item"> <a href="/tags"><span>23</span> <span>标签</span></a></div></nav><div class="social-wrap"><a href="https://github.com/wszgxa" target="_blank"><div class="item"><i class="i-github"></i></div></a><a href="http://v2ex.com/member/hiluluke" target="_blank"><div class="item"><i class="i-v2ex"></i></div></a><a href="https://www.zhihu.com/people/zhao-guo-xu" target="_blank"><div class="item"><i class="i-zhihu"></i></div></a><a href="https://twitter.com/Hiluluke" target="_blank"><div class="item"><i class="i-twitter"></i></div></a><a href="http://codepen.io/hiluluke" target="_blank"><div class="item"><i class="i-codepen"></i></div></a></div></aside><div class="wrap"><div class="side"><div class="top" id="back-top"></div><div class="arrows" id="nav-btn"></div></div><header class="header menu-2016"><nav> <a class="menu-item-home" href="/">首页</a> <a class="menu-item-categories" href="/categories">分类</a> <a class="menu-item-tags" href="/tags">标签</a> <a class="menu-item-about" href="/about">关于</a> <a class="menu-item-rss" href="/atom.xml">RSS</a></nav></header><section id="main" class="content"><div class="archives-wrap"><div class="archives"><div class="title-wrap"><h1>使用Vue快速开发单页应用 <small>登录页面</small></h1><div class="page-info"> <span>By <a href="/about">hiluluke</a> on</span> <time datetime="2016-08-19T16:00:00.000Z" itemprop="datePublished">Aug 20 2016</time></div></div><div class="content-wrap"><blockquote><p>本文所涉及代码全在<a href="https://github.com/wszgxa/vue-cnode" target="_blank" rel="external">vue-cnode</a></p></blockquote><p>前面两篇都是介绍组织结构和vue-router，从本文开始我们将讲一些如何优雅的用vue编写单页应用。首先我们从登录页面以及开始，因为后续很多其它的页面都需要登录信息。</p><h2 id="路由，文件组织"><a href="#路由，文件组织" class="headerlink" title="路由，文件组织"></a>路由，文件组织</h2><p>首先我们第一步肯定是指定一条路由啦，在<code>src/config_router.js</code>里面增加一条路由<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">configRouter</span> (<span class="params">router</span>) </span>&#123;</div><div class="line">  router.map(&#123;</div><div class="line">    <span class="string">'/login'</span>: &#123;</div><div class="line">      name: <span class="string">'login'</span>,</div><div class="line">      title: <span class="string">'登录'</span>,</div><div class="line">      <span class="comment">// es6箭头函数</span></div><div class="line">      component: (resolve) =&gt; <span class="built_in">require</span>([<span class="string">'./components/login/login.vue'</span>], resolve)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><a id="more"></a><p>上面compenents部分，使用了webpack代码分割功能，这样他会安需加在<code>./components/login/login.vue</code>组件。也可以这样写<code>component: require(&#39;./components/login/login.vue&#39;)</code>，这样就不会按需载入了。编译的第一个文件就有这个。</p><p>然后我们需要在<code>src/conponengts/</code>下面创建一个login的文件夹一个login.vue的文件。最开始login.vue里面应该是这样的：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;style lang="styl" src='../../assets/styl/login.styl' scoped&gt;&lt;/style&gt;</div><div class="line"></div><div class="line">&lt;template&gt;</div><div class="line">  &lt;section class="content"&gt;</div><div class="line">  // something</div><div class="line">  &lt;/section&gt;</div><div class="line">&lt;/template&gt;</div><div class="line">&lt;script&gt;</div><div class="line">  export default &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure><p>上面是vue-loader的结构，你可以看到，样式、模版、js三者很清晰，不像react中的写法全是js，jsx感觉还有点混乱（个人观点）。</p><p>上面的style中<code>lang</code>是指定解析语言，我们这里用的是<a href="http://stylus-lang.com/" target="_blank" rel="external">stylus</a>，然后<code>src</code>指定文件路径，最后的一个scoped是指定样式只在当前组件生效。template和script里面的内容就部多介绍了，现在开始编写业务逻辑。</p><h2 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h2><p>这里我们不介绍<a href="https://github.com/vuejs/vuex" target="_blank" rel="external">vuex</a>是个啥，文档在<a href="http://vuex.vuejs.org/" target="_blank" rel="external">这里</a>。</p><p>我们需要保存登录的信息，因为在后续的所有接口中去获取数据我们都需要服务器返回的用户信息。这里我们将获取用户信息、保存用户信息逻辑全部拆出来交给vuex。</p><h3 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h3><p>先安装vuex：<code>npm install vuex --save</code>，然后我们建一个<code>store</code>。在src文件夹下面创建`/vuex/modules/user_info.js：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// content</span></div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  SET_BASEINFO,</div><div class="line">  SET_DETAIL</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'../mutation_types'</span></div><div class="line"><span class="keyword">const</span> state = &#123;</div><div class="line">  <span class="comment">// 保存第一页数据</span></div><div class="line">  id: <span class="string">''</span>,</div><div class="line">  accessToken: <span class="string">''</span>,</div><div class="line">  loginName: <span class="string">''</span>,</div><div class="line">  avatarUrl: <span class="string">''</span>,</div><div class="line">  score: <span class="string">''</span>,</div><div class="line">  recentTopics: <span class="string">''</span>,</div><div class="line">  recentReplies: <span class="string">''</span>,</div><div class="line">  github: <span class="string">''</span>,</div><div class="line">  createAt: <span class="string">''</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> mutations = &#123;</div><div class="line">  <span class="comment">// 设置 token 登录名 头像</span></div><div class="line">  [SET_BASEINFO] (state, data) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      state.id = data.id</div><div class="line">      state.accessToken = data.accesstoken</div><div class="line">      state.loginName = data.loginname</div><div class="line">      state.avatarUrl = data.avatar_url</div><div class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</div><div class="line">      <span class="built_in">console</span>.log(err)</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  [SET_DETAIL] (state, data) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      state.score = data.score</div><div class="line">      state.recentTopics = data.recent_topics</div><div class="line">      state.recentReplies = data.recent_replies</div><div class="line">      state.github = data.githubUsername || <span class="string">''</span></div><div class="line">      state.createAt = data.create_at</div><div class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</div><div class="line">      <span class="built_in">console</span>.log(err)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  state,</div><div class="line">  mutations</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>上面有个<code>mutation_types</code>是用来让mutation唯一的，在mutation_types里面是这样的：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// user info</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> SET_BASEINFO = <span class="string">'SET_BASEINFO'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> SET_DETAIL = <span class="string">'SET_DETAIL'</span></div></pre></td></tr></table></figure><p></p><p>用<code>const</code>来保证唯一性。</p><p>然后我们需要将modules加到store里面，新建一个<code>/src/vuex/store.js</code>文件：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></div><div class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></div><div class="line"><span class="keyword">import</span> userInfo <span class="keyword">from</span> <span class="string">'./modules/user_info'</span></div><div class="line">Vue.use(Vuex)</div><div class="line"></div><div class="line"><span class="keyword">const</span> debug = process.env.NODE_ENV !== <span class="string">'production'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</div><div class="line">  modules: &#123;</div><div class="line">    userInfo</div><div class="line">  &#125;,</div><div class="line">  strict: debug,</div><div class="line">  middlewares: debug ? [] : []</div><div class="line">&#125;)</div></pre></td></tr></table></figure><p></p><p>再把其在App.vue里面引用，App.vue加入：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./vuex/store'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  store</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>这样我们就可以用:<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vuex: &#123;</div><div class="line">  getters: &#123;</div><div class="line">    accessToken: (&#123; userInfo &#125;) =&gt; userInfo.accessToken</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>来获取用户数据了。</p><h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><p>我们将获取用户信息，保存用户信息的逻辑全放在vuex的actions里面，而不是在业务逻辑里面获取，只是在vuex里面保存一下。这样业务逻辑就更扁平了，数据的获取只需要调用一下actions里面的函数，用getter来动态获取。具体代码如下：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /src/vuex/actions/user_actions.js</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> types <span class="keyword">from</span> <span class="string">'../mutation_types'</span></div><div class="line"><span class="keyword">import</span> &#123; setMsg &#125; <span class="keyword">from</span> <span class="string">'../../tool'</span></div><div class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></div><div class="line"><span class="keyword">let</span> localStorage = <span class="built_in">window</span>.localStorage</div><div class="line"><span class="keyword">let</span> storeBaseInfo = (data) =&gt; &#123;</div><div class="line">  localStorage.setItem(<span class="string">'cnodeBaseInfo'</span>, <span class="built_in">JSON</span>.stringify(data))</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> storeDetailInfo = (data) =&gt; &#123;</div><div class="line">  localStorage.setItem(<span class="string">'cnodeDetailInfo'</span>, <span class="built_in">JSON</span>.stringify(data))</div><div class="line">&#125;</div><div class="line"><span class="comment">// 获取存储在localStorage中的数据</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStore = (&#123; dispatch, state &#125;) =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (localStorage.getItem(<span class="string">'cnodeBaseInfo'</span>)) &#123;</div><div class="line">    <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">'cnodeBaseInfo'</span>))</div><div class="line">    dispatch(types.SET_BASEINFO, data)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (localStorage.getItem(<span class="string">'cnodeDetailInfo'</span>)) &#123;</div><div class="line">    <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">'cnodeDetailInfo'</span>))</div><div class="line">    dispatch(types.SET_DETAIL, data)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 设置基础数据</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> setBaseInfo = (&#123; dispatch, state &#125;, token, callback) =&gt; &#123;</div><div class="line">  Vue.http(&#123;</div><div class="line">    url: <span class="string">'/api/v1/accesstoken'</span>,</div><div class="line">    method: <span class="string">'POST'</span>,</div><div class="line">    body: <span class="built_in">JSON</span>.stringify(&#123;</div><div class="line">      accesstoken: token</div><div class="line">    &#125;),</div><div class="line">    headers: &#123;</div><div class="line">      contentType: <span class="string">'application/x-www-form-urlencoded'</span></div><div class="line">    &#125;</div><div class="line">  &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse(res.data)</div><div class="line">    <span class="keyword">if</span> (data.success) &#123;</div><div class="line">      data.accesstoken = token</div><div class="line">      <span class="keyword">delete</span> data.success</div><div class="line">      storeBaseInfo(data)</div><div class="line">      dispatch(types.SET_BASEINFO, data)</div><div class="line">      callback(setMsg(<span class="literal">true</span>, <span class="string">'登录成功'</span>))</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="built_in">console</span>.log(data.error_msg)</div><div class="line">      callback(setMsg(<span class="literal">false</span>, data.error_msg))</div><div class="line">    &#125;</div><div class="line">  &#125;).catch(err =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(err)</div><div class="line">    <span class="keyword">let</span> errBody = <span class="built_in">JSON</span>.parse(err.body)</div><div class="line">    callback(setMsg(<span class="literal">false</span>, errBody.error_msg))</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>上面有个setMsg的函数，只是用来将格式化返回给组件的内容的，把action写的就像一个接口一样。</p><p>上面用了<a href="https://github.com/vuejs/vue-resource" target="_blank" rel="external">vue-resource</a>。然后我们做的事主要就件，调用接口，拿数据，错误处理，保存数据到localStorage，返回数据。</p><p>接下来，我们看看组件里面的获取数据：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> dialog <span class="keyword">from</span> <span class="string">'../common/dialog'</span></div><div class="line">  <span class="keyword">import</span> &#123; setBaseInfo, setDetail &#125; <span class="keyword">from</span> <span class="string">'../../vuex/actions/user_actions'</span></div><div class="line">  <span class="keyword">import</span> &#123; setMenu, setTip &#125; <span class="keyword">from</span> <span class="string">'../../vuex/actions/doc_actions'</span></div><div class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">    vuex: &#123;</div><div class="line">      actions: &#123;</div><div class="line">        setBaseInfo,</div><div class="line">        setMenu,</div><div class="line">        setTip,</div><div class="line">        setDetail</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    data () &#123;</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        config: &#123;</div><div class="line">          visible: <span class="literal">false</span>,</div><div class="line">          text: <span class="string">'在 Cnode社区网站端登录你的账户，然后在右上角找到【设置】按钮，点击进入后将页面滑动到最底部来查看你的Access Token。'</span>,</div><div class="line">          sureText: <span class="string">'确定'</span></div><div class="line">        &#125;,</div><div class="line">        access: <span class="string">''</span></div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    methods: &#123;</div><div class="line">      dialog () &#123;</div><div class="line">        <span class="keyword">this</span>.config.visible = <span class="literal">true</span></div><div class="line">      &#125;,</div><div class="line">      success () &#123;</div><div class="line">        <span class="built_in">window</span>.history.go(<span class="number">-1</span>)</div><div class="line">        <span class="keyword">this</span>.setMenu(<span class="literal">true</span>)</div><div class="line">        <span class="keyword">this</span>.setDetail()</div><div class="line">      &#125;,</div><div class="line">      login () &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.access.length &lt; <span class="number">6</span>) &#123;</div><div class="line">          <span class="keyword">this</span>.setTip(&#123;</div><div class="line">            text: <span class="string">'请输入正确的Access Token'</span></div><div class="line">          &#125;)</div><div class="line">          <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.setBaseInfo(<span class="keyword">this</span>.access, (res) =&gt; &#123;</div><div class="line">          <span class="keyword">if</span> (res.success) &#123;</div><div class="line">            <span class="keyword">this</span>.success()</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">this</span>.setTip(&#123;</div><div class="line">            text: res.msg</div><div class="line">          &#125;)</div><div class="line">        &#125;)</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    components: &#123;</div><div class="line">      dialog</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure><p></p><p>首先引入actions,然后调用，因为返回数据格式事固定的，直接做判断，错误就用dialog弹错错误。是不是很清爽。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>我感觉要仔仔细细把所有全部讲完，篇幅太长了。。。大家还是看看我这做个指引，具体还是看<a href="https://github.com/vuejs/vue-router" target="_blank" rel="external">代码</a></p></div></div></div><div class="ds-thread" data-thread-key="2016/08/20/vue-first/" data-title="使用Vue快速开发单页应用" data-url="http://hiluluke.cn/2016/08/20/vue-first/"></div></section><footer class="footer"><div>我是一个粉刷匠</div><div>由 <a href="https://hexo.io/">Hexo</a> 强力驱动 | 主题- <a href="https://github.com/wszgxa/hexo-theme-simple">Simple</a></div></footer></div></div><script src="/js/simple_build.js"></script><script type="text/javascript">var duoshuoQuery={short_name:"hiluluke"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-83014983-1","auto"),ga("send","pageview")</script></body></html>