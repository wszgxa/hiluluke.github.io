<!DOCTYPE html><html><head><meta charset="utf-8"><link rel="dns-prefetch" href="//7fvhwe.com1.z0.glb.clouddn.com/"><link rel="dns-prefetch" href="//hilus-note.disqus.com"><link rel="dns-prefetch" href="//www.google-analytics.com/"><title> JS函数式编程 - 函子和范畴轮 | hilu&#39;s note</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="alternate" href="" title="hilu&#39;s note" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><style>.menu-home .menu-item-home{color:#b71c1c}.menu-categories .menu-item-categories{color:#b71c1c}.menu-tags .menu-item-tags{color:#b71c1c}.menu-about .menu-item-about{color:#b71c1c}.menu-rss .menu-item-rss{color:#b71c1c}</style><style>blockquote,body,button,dd,dl,dt,fieldset,form,h1,h2,h3,h4,h5,h6,hr,input,legend,li,ol,p,pre,td,textarea,th,ul{margin:0;padding:0}.wrap,body{position:relative}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:100%}address,cite,dfn,em,i,var{font-style:normal}code,kbd,pre,samp{font-family:courier new,courier,monospace}small{font-size:16px}ol,ul{list-style:none}a{text-decoration:none}.archives .content-wrap a:hover,.cate-list a:hover,.content .gist .gist-file .gist-meta a:hover,.footer a:hover{text-decoration:underline}fieldset,img{border:0}input,select{-webkit-tap-highlight-color:transparent}@-moz-keyframes flow{from{transform:translate3d(0,-30px,0);opacity:0}to{transform:translate3d(0,0,0);opacity:1}}@-webkit-keyframes flow{from{transform:translate3d(0,-30px,0);opacity:0}to{transform:translate3d(0,0,0);opacity:1}}@-o-keyframes flow{from{transform:translate3d(0,-30px,0);opacity:0}to{transform:translate3d(0,0,0);opacity:1}}@keyframes flow{from{transform:translate3d(0,-30px,0);opacity:0}to{transform:translate3d(0,0,0);opacity:1}}body,html{height:100%}html{-webkit-overflow-scrolling:touch;-webkit-text-size-adjust:100%}body{word-break:break-all;word-wrap:break-word;font-size:1em;line-height:1.5;font-family:"Lantinghei SC","Open Sans",Arial,"Hiragino Sans GB","Microsoft YaHei",STHeiti,"WenQuanYi Micro Hei",SimSun,Helvetica,sans-serif;background:#fefefe;color:#323232}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_1469071762_054906.eot);src:url(//at.alicdn.com/t/font_1469071762_054906.eot?#iefix) format('embedded-opentype'),url(//at.alicdn.com/t/font_1469071762_054906.woff) format('woff'),url(//at.alicdn.com/t/font_1469071762_054906.ttf) format('truetype'),url(//at.alicdn.com/t/font_1469071762_054906.svg#iconfont) format('svg')}.i-codepen,.i-douban,.i-facebook,.i-github,.i-left,.i-next,.i-right,.i-twitter,.i-v2ex,.i-weibo,.i-zhihu{font-family:iconfont;font-size:18px;font-style:normal;color:#616171}.i-weibo::after{content:'\e607'}.i-github::after{content:'\e60a'}.i-v2ex::after{content:'\e606'}.i-douban::after{content:'\e605'}.i-zhihu::after{content:'\e608'}.i-twitter::after{content:'\e609'}.i-facebook::after{content:'\e60b'}.i-codepen::after{content:'\e601'}.i-left::after{content:'\e600'}.i-right::after{content:'\e602'}.i-next::after{content:'\e603'}.wrap{transition:.3s all ease-in-out}.side,.sidebar{position:fixed}.header{max-width:840px;margin:0 auto 20px;text-align:center;background-color:#fff;box-shadow:0 1px 3px #e3e3e3;-webkit-box-shadow:0 1px 3px #e3e3e3;-moz-box-shadow:0 1px 3px #e3e3e3;-ms-box-shadow:0 1px 3px #e3e3e3;-o-box-shadow:0 1px 3px #e3e3e3}.header a:hover,.side .arrows,.side .top{background-color:#e3e3e3}.header a{color:#323232;display:inline-block;padding:10px;transition:background-color .2s ease}.header .ac{color:#b71c1c}.side{bottom:40px;transition:.3s all}.side .arrows,.side .top{width:35px;height:35px;border:1px solid transparent;line-height:35px;text-align:center;cursor:pointer;border-radius:3px}.side .arrows:after,.side .top:after{content:'\e602';font-family:iconfont;font-size:16px;color:#323232}.sidebar .desc,.sidebar .name{font-size:15px;text-align:center}.side .arrows:hover:after,.side .top:hover:after{color:#b71c1c}.side .top{margin-bottom:1px;transform:rotate3d(0,0,1,-90deg);-webkit-transform:rotate3d(0,0,1,-90deg);-moz-transform:rotate3d(0,0,1,-90deg);-ms-transform:rotate3d(0,0,1,-90deg);-o-transform:rotate3d(0,0,1,-90deg)}.sideShow .arrows{transform:rotate3d(0,1,0,180deg);-webkit-transform:rotate3d(0,1,0,180deg);-moz-transform:rotate3d(0,1,0,180deg);-ms-transform:rotate3d(0,1,0,180deg);-o-transform:rotate3d(0,1,0,180deg)}.sideShow .side{transform:translate3d(2px,0,0);-webkit-transform:translate3d(2px,0,0);-moz-transform:translate3d(2px,0,0);-ms-transform:translate3d(2px,0,0);-o-transform:translate3d(2px,0,0)}.sideShow .wrap{padding-left:210px}.sideShow .sidebar{transform:none;-webkit-transform:none;-moz-transform:none;-ms-transform:none;-o-transform:none;box-shadow:1px 0 5px #ededed;-webkit-box-shadow:1px 0 5px #ededed;-moz-box-shadow:1px 0 5px #ededed;-ms-box-shadow:1px 0 5px #ededed;-o-box-shadow:1px 0 5px #ededed}.sidebar{left:0;top:0;bottom:0;z-index:2;width:210px;transform:translate3d(-210px,0,0);-webkit-transform:translate3d(-210px,0,0);-moz-transform:translate3d(-210px,0,0);-ms-transform:translate3d(-210px,0,0);-o-transform:translate3d(-210px,0,0);transition:transform .3s ease-in-out;background-color:#ededed}.sidebar .head-icon{margin:30px auto 10px;width:72px;height:72px}.sidebar .head-icon img{width:60px;height:60px;border:6px solid rgba(255,255,255,.85);border-radius:50%}.sidebar .desc{margin:0 auto;color:#707070;max-width:180px}.sidebar .name{color:#000;padding:0 0 10px}.sidebar .side-nav{margin-top:35px;text-align:center;font-size:16px}.sidebar .side-nav .nav-item{display:inline-block;padding:0 4px}.sidebar .side-nav .nav-item span{color:#616171;display:block;transition:.2s color}.sidebar .side-nav .nav-item:hover span,.sidebar .social-wrap .item:hover i{color:#000}.sidebar .side-nav .nav-item:nth-child(n+2){border-left:2px solid #e0e0e0}.sidebar .social-wrap{margin:30px auto 0;width:180px;text-align:center}.sidebar .social-wrap .item{padding:5px;display:inline-block;transition:.2s all ease-in-out}.sidebar .social-wrap .item:hover{background-color:#e3e3e3}.content{max-width:760px;min-height:768px;margin:0 auto;padding:20px 40px;background-color:#fff;box-shadow:0 1px 3px #e3e3e3;-webkit-box-shadow:0 1px 3px #e3e3e3;-moz-box-shadow:0 1px 3px #e3e3e3;-ms-box-shadow:0 1px 3px #e3e3e3;-o-box-shadow:0 1px 3px #e3e3e3}.archives{margin-bottom:50px;animation:flow 530ms ease-in-out}.archives .title-wrap{margin:20px 0;padding-bottom:10px;border-bottom:1px solid #e0e0e0}.archives .read-more a:hover,.archives .title-wrap .page-info a:hover{border-bottom:1px solid #1b1a1a}.archives .title-wrap h1{font-size:1.8em;color:#202020}.archives .title-wrap .post-title{position:relative;display:inline-block}.archives .title-wrap .post-title::before{content:'';bottom:0;width:100%;position:absolute;border-top:2px solid #1b1a1a;transform:scale3d(0,1,1);-webkit-transform:scale3d(0,1,1);-moz-transform:scale3d(0,1,1);-ms-transform:scale3d(0,1,1);-o-transform:scale3d(0,1,1);transition:transform .2s ease-in-out}.archives .title-wrap .post-title:hover::before{transform:scale3d(1,1,1);-webkit-transform:scale3d(1,1,1);-moz-transform:scale3d(1,1,1);-ms-transform:scale3d(1,1,1);-o-transform:scale3d(1,1,1)}.archives .title-wrap .page-info{font-size:16px;color:#616171}.archives .title-wrap .page-info a{color:#616171}.archives .read-more{text-align:left}.archives .read-more a{color:#202020;line-height:14px;transition:all .2s ease-in-out}.archives .read-more a:hover span{color:#000}.archives .read-more a span{font-size:14px}.archives .read-more a span::after{font-size:12px}.archives .content-wrap h1,.archives .content-wrap h2,.archives .content-wrap h3,.archives .content-wrap h4{color:#b71c1c;margin:1.5em 0 1em}.archives .content-wrap h1{font-size:1.75em}.archives .content-wrap h2{font-size:1.5em}.archives .content-wrap h3,.archives .content-wrap h4{font-size:1.1em}.archives .content-wrap blockquote{border-left:.3em solid #e0e0e0}.archives .content-wrap blockquote p{padding-left:.8em}.archives .content-wrap ul{padding-left:1.5em}.archives .content-wrap ul li{list-style:circle}.archives .content-wrap .code,.archives .content-wrap figure table{border:none}.archives .content-wrap p{margin:1em 0;text-align:justify}.archives .content-wrap img{display:block;max-width:90%;margin:0 auto;border:1px solid #e0e0e0}.archives .content-wrap a{color:#4078c0}.page-nav .current,.page-nav a{color:#616171}.archives .content-wrap table{max-width:80%;margin:0 auto;border:1px solid #ddd;border-spacing:0;border-collapse:collapse}.archives .content-wrap th{padding:8px;text-align:left;line-height:1.42857143;vertical-align:bottom;border:1px solid #ddd;border-bottom-width:2px;box-sizing:border-box}.cate-head,.ct-title,.footer,.page-nav,.tags-cloud{text-align:center}.archives .content-wrap td{border:1px solid #ddd;padding:8px;line-height:1.42857143;vertical-align:top}.page-nav .current,.page-nav .extend:hover,.page-nav .page-number:hover{border-bottom:1px solid #000}.page-nav{margin:40px 0}.page-nav .extend,.page-nav .page-number,.page-nav .space{position:relative;display:inline-block;width:30px;height:30px;margin:0 10px}.page-nav .page-number{text-align:center;font-size:16px;line-height:30px}.page-nav .extend{line-height:30px}.page-nav .extend i{font-size:12px}.ds-thread{width:96%;margin:0 auto}.content .highlight,.content pre{background:#fafafa;margin:1em auto;padding:10px;overflow:auto;color:#515151;line-height:1.5;white-space:pre;word-spacing:normal;word-break:normal}.content .gist .gist-file .gist-data .line-numbers{color:#666;font-size:.85em}.content code,.content pre{font-family:consolas,menlo,monospace}.content code{background:#fefefe;text-shadow:0 1px #fff;padding:0 .3em}.content pre code{background:0 0;text-shadow:none;padding:0}.content .highlight pre{border:none;margin:0;padding:0}.content .highlight table{margin:0;width:auto}.content .highlight td{border:none;padding:0}.content .highlight figcaption{font-size:.85em;color:#999;line-height:1em;margin-bottom:1em}.content .highlight figcaption a{float:right}.content .highlight .gutter pre{display:none}.content .highlight .line{height:1.5em}.content .highlight .line.marked{background:#515151}.content .gist{margin:0 -20px;border-style:solid;border-color:#e0e0e0;border-width:1px 0;background:#fafafa;padding:15px 20px 15px 0}.content .gist .gist-file{border:none;font-family:font-mono;margin:0}.content .gist .gist-file .gist-data{background:0 0;border:none}.content .gist .gist-file .gist-data .line-numbers{background:0 0;border:none;padding:0 20px 0 0}.content .gist .gist-file .gist-data .line-data{padding:0!important}.content .gist .gist-file .highlight{margin:0;padding:0;border:none}.content .gist .gist-file .gist-meta{background:#fafafa;color:#999;font:.85em font-sans;text-shadow:0 0;padding:0;margin-top:1em;margin-left:20px}.content .gist .gist-file .gist-meta a{color:color-link;font-weight:400}pre .comment,pre .title{color:#999}pre .attribute,pre .css .class,pre .css .id,pre .css .pseudo,pre .html .doctype,pre .regexp,pre .ruby .constant,pre .tag,pre .variable,pre .xml .doctype,pre .xml .pi,pre .xml .tag .title{color:#f2777a}pre .built_in,pre .constant,pre .literal,pre .number,pre .params,pre .preprocessor{color:#f99157}pre .class,pre .css .rules .attribute,pre .header,pre .inheritance,pre .ruby .class .title,pre .ruby .symbol,pre .string,pre .value,pre .xml .cdata{color:#9c9}pre .css .hexcolor{color:#6cc}pre .coffeescript .title,pre .function,pre .javascript .title,pre .perl .sub,pre .python .decorator,pre .python .title,pre .ruby .function .title,pre .ruby .title .keyword{color:#69c}pre .javascript .function,pre .keyword{color:#c9c}.cate-head{margin-top:20px;font-size:1.5em}.cate-list-item{display:inline-block;padding:0 8px}.cate-list{max-width:80%;margin:40px auto 0}.cate-list a{color:#323232;padding:5px}.cate-list span,.ct-title small{color:#616171}.cate-list span:before{content:'['}.cate-list span:after{content:']'}.tags-cloud{width:80%;margin:20px auto 0;text-indent:4px;word-break:normal}.tags-cloud a{display:inline-block;margin:5px}.tags-cloud a:hover{border-bottom:1px solid #e3e3e3}.ct-title{margin:10px auto 20px}.ct-title h2{font-size:1.75em}.footer{max-width:760px;margin:10px auto 0;background-color:#fff;box-shadow:0 0 5px #e3e3e3;-webkit-box-shadow:0 0 5px #e3e3e3;-moz-box-shadow:0 0 5px #e3e3e3;-ms-box-shadow:0 0 5px #e3e3e3;-o-box-shadow:0 0 5px #e3e3e3;padding:10px 40px}.footer a{color:#4078c0}.footer div{padding:5px}@media screen and (max-width:800px){.side{display:none}.content{padding:20px}.footer,.header{max-width:800px}.page-nav .page-number{width:25px;height:25px;line-height:25px}}</style></head><body><script type="text/javascript">!function(){"true"==localStorage.getItem("sidebarState")&&(document.body.className="sideShow")}()</script><div id="container"><aside class="sidebar"><div class="head-icon"> <a href="/about"><img src="/avatar.jpeg"></a></div><div class="name">hiluluke</div><div class="desc"><h4>我是一个粉刷匠</h4></div><nav class="side-nav"><div class="nav-item"> <a href="/"><span>38</span> <span>日志</span></a></div><div class="nav-item"> <a href="/categories"><span>8</span> <span>分类</span></a></div><div class="nav-item"> <a href="/tags"><span>26</span> <span>标签</span></a></div></nav><div class="social-wrap"><a href="https://github.com/wszgxa" target="_blank"><div class="item"><i class="i-github"></i></div></a><a href="http://v2ex.com/member/hiluluke" target="_blank"><div class="item"><i class="i-v2ex"></i></div></a><a href="https://www.zhihu.com/people/zhao-guo-xu" target="_blank"><div class="item"><i class="i-zhihu"></i></div></a><a href="https://twitter.com/Hiluluke" target="_blank"><div class="item"><i class="i-twitter"></i></div></a><a href="http://codepen.io/hiluluke" target="_blank"><div class="item"><i class="i-codepen"></i></div></a></div></aside><div class="wrap"><div class="side"><div class="top" id="back-top"></div><div class="arrows" id="nav-btn"></div></div><header class="header menu-2018"><nav> <a class="menu-item-home" href="/">首页</a> <a class="menu-item-categories" href="/categories">分类</a> <a class="menu-item-tags" href="/tags">标签</a> <a class="menu-item-about" href="/about">关于</a> <a class="menu-item-rss" href="/atom.xml">RSS</a></nav></header><section id="main" class="content"><div class="archives-wrap"><div class="archives"><div class="title-wrap"><h1>JS函数式编程 - 函子和范畴轮</h1><div class="page-info"> <span>By <a href="/about">hiluluke</a> on</span> <time datetime="2018-10-12T16:00:00.000Z" itemprop="datePublished">Oct 13 2018</time></div></div><div class="content-wrap"><p>在前面几篇介绍了函数式比较重要的一些概念和如何用函数组合去解决相对复杂的逻辑。是时候开始介绍如何控制副作用了。</p><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>我们来看看<a href="https://segmentfault.com/a/1190000016671245" target="_blank" rel="noopener">上一篇</a>最后例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> split = curry(<span class="function">(<span class="params">tag, xs</span>) =&gt;</span> xs.split(tag))</span><br><span class="line"><span class="keyword">const</span> reverse = <span class="function"><span class="params">xs</span> =&gt;</span> xs.reverse()</span><br><span class="line"><span class="keyword">const</span> join = curry(<span class="function">(<span class="params">tag, xs</span>) =&gt;</span> xs.join(tag))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reverseWords = compose(join(<span class="string">''</span>), reverse, split(<span class="string">''</span>))</span><br><span class="line"></span><br><span class="line">reverseWords(<span class="string">'Hello,world!'</span>);</span><br></pre></td></tr></table></figure><p>这里其实<code>reverseWords</code>还是很难阅读，你不知道他入参是啥，返回值又是啥。你如果不去看一下代码，一开始在使用他的时候，你应该是比较害怕的。 “我是不是少传了一个参数？是不是传错了参数？返回值真的一直都是一个字符串吗？”。这也是类型系统的重要性了，在不断了解函数式后，你会发现，函数式编程和类型是密切相关的。如果在这里<code>reverseWords</code>的类型明确给出，就相当于文档了。</p><p>但是，JavaScript是动态类型语言，我们不会去明确的指定类型。不过我们可以通过注释的方式加上类型:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reverseWords: string =&gt; string</span></span><br><span class="line"><span class="keyword">const</span> reverseWords = compose(join(<span class="string">''</span>), reverse, split(<span class="string">''</span>))</span><br></pre></td></tr></table></figure><p>上面就相当于指定了<code>reverseWords</code>是一个接收字符串，并返回字符串的函数。</p><p>JS 本身不支持静态类型检测，但是社区有很多JS的超集是支持类型检测的，比如<a href="https://github.com/facebook/flow" target="_blank" rel="noopener">Flow</a>还有<a href="https://github.com/Microsoft/TypeScript" target="_blank" rel="noopener">TypeScript</a>。当然类型检测不光是上面所说的自文档的好处，它还能在预编译阶段提前发现错误，能约束行为等。</p><p>当然我的后续文章还是以JS为语言，但是会在注释里面加上类型。</p><a id="more"></a><h2 id="范畴论相关概念"><a href="#范畴论相关概念" class="headerlink" title="范畴论相关概念"></a>范畴论相关概念</h2><p>范畴论其实并不是特别难，不过是些抽象点的概念。而且我们其实不需要了解的特别深，函数式编程很多概念是从范畴论映射过来的。了解范畴论相关概念有助于我们理解函数式编程。另外，相信我，只要你小学初中学过一元函数和集合，看懂下面的没有问题。</p><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>范畴的定义：</p><ol><li>一组对象，是需要操作的数据的一个集合</li><li>一组态射，是数据对象上的映射关系，比如 f: A -&gt; B</li><li>态射组合，就是态射能够几个组合在一起形成一个新的态射</li></ol><p><img src="/images/Category_SVG.svg" alt=""></p><p></p><div style="display:none"><br> <img alt="I am the test alt." src="http://hiluluke.cn/images/test.jpeg"></div><p></p><p></p><div><br>图片出处：<a href="https://en.wikipedia.org/wiki/Category_theory" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Category_theory</a></div><p></p><p>一个简单的例子，上图来自维基百科。上面就是一个范畴，一共有3个数据对象<code>A,B,C</code>，然后<code>f</code>和<code>g</code>是态射，而<code>gof</code>是一组态射组合。是不是很简单？</p><p>其中态射可以理解是函数，而态射的组合，我们可以理解为函数的组合。而里面的一组对象，不就是一个具有一些相同属性的数据集嘛。</p><h3 id="函子-functor"><a href="#函子-functor" class="headerlink" title="函子(functor)"></a>函子(functor)</h3><p>函子是用来将两个范畴关联起来的。</p><p><img src="/images/altfunctor.jpg" alt=""><br>图片出处：<a href="https://ncatlab.org/nlab/show/functor" target="_blank" rel="noopener">https://ncatlab.org/nlab/show/functor</a></p><p>对应上图，比如对于范畴 C 和 D ，函子 F : C =&gt; D 能够：将 C 中任意对象X 转换为 D 中的 F(X); 将 C 中的态射 f : X =&gt; Y 转换为 D 中的 F(f) : F(X) =&gt; F(Y)。你可以发现函子可以：</p><ol><li>转换对象</li><li>转换态射</li></ol><h2 id="构建一个函子-functor"><a href="#构建一个函子-functor" class="headerlink" title="构建一个函子(functor)"></a>构建一个函子(functor)</h2><h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3><p>正如上面所说，函子能够关联两个范畴。而范畴里面必然是有一组数据对象的。这里引入Container，就是为了引入数据对象：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (value) &#123;</span><br><span class="line">    <span class="keyword">this</span>.$value = value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// (value) =&gt; Container(value)</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">of</span>(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Container(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>我们声明了一个Container的类，然后给了一个静态的of方法用于去生成这个Container的实例。这个of其实还有个好听的名字，卖个关子，后面介绍。</p><p>我们来看一下使用这个<code>Container</code>的例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Container(123)</span></span><br><span class="line">Container.of(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Container("Hello Conatiner!")</span></span><br><span class="line">Container.of(<span class="string">"Hello Conatiner!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Container(Conatiner("Test !"))</span></span><br><span class="line">Container.of(Container.of(<span class="string">"Test !"</span>))</span><br></pre></td></tr></table></figure><p>正如上面看到的，Container是可以嵌套的。我们仔细看一下这个Contaienr：</p><ol><li>$value的类型不确定，但是一旦赋值之后，类型就确定了</li><li>一个Conatiner只会有一个value</li><li>我们虽然能直接拿到$value，但是不要这样做，不然我们要个container干啥呢</li></ol><h3 id="第一个functor"><a href="#第一个functor" class="headerlink" title="第一个functor"></a>第一个functor</h3><p>让我们回看一下定义，函子是用来将两个范畴关联起来的。所以我们还需要一个态射（函数）去把两个范畴关联起来：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (value) &#123;</span><br><span class="line">    <span class="keyword">this</span>.$value = value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// (value) =&gt; Container(value)</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">of</span>(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Container(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// (fn: x=&gt;y) =&gt; Container(fn(value))</span></span><br><span class="line">  map(fn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Container(fn(<span class="keyword">this</span>.$value))</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先来用一把：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> concat = curry(<span class="function">(<span class="params">str, xs</span>) =&gt;</span> xs.concat(str))</span><br><span class="line"><span class="keyword">const</span> prop = curry(<span class="function">(<span class="params">prop, xs</span>) =&gt;</span> xs[prop])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Container('TEST')</span></span><br><span class="line">Container.of(<span class="string">'test'</span>).map(<span class="function"><span class="params">s</span> =&gt;</span> s.toUpperCase())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Container(10)</span></span><br><span class="line">Container.of(<span class="string">'bombs'</span>).map(concat(<span class="string">' away'</span>)).map(prop(<span class="string">'length'</span>));</span><br></pre></td></tr></table></figure><p>不晓得上面的curry是啥的看<a href="https://segmentfault.com/a/1190000016671245?_ea=4737845" target="_blank" rel="noopener">第二篇文章</a>。</p><p>你可能会说：“哦，这是你说的functor，那又有啥用呢？”。接下来，就讲一个应用。</p><p>不过再讲应用前先讲一下这个<code>of</code>，其实上面这种functor，叫做<code>pointed functor</code>, ES5里面的Array就应用了这种模式：<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/of" target="_blank" rel="noopener">Array.of</a>。他是一种模式，不仅仅是用来省略构建对象的new关键字的。我感觉和scala里面的<code>compaion object</code>有点类似。</p><h2 id="Maybe-type"><a href="#Maybe-type" class="headerlink" title="Maybe type"></a>Maybe type</h2><p>在现实的代码中，存在很多数据是可选的，返回的数据可能是存在的也可能不存在：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type Person = &#123;</span><br><span class="line">  info?: &#123;</span><br><span class="line">    age?: string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面是flow里面的类型声明，其中<code>?</code>代表这个数据可能存在，可能不存在。我相信像上面的数据结构，你在接收后端返回的数据的时候经常遇到。假如我们要取这个<code>age</code>属性，我们通常是怎么处理的呢？<br>当然是加判断啦:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">info</span>: &#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getAge = <span class="function">(<span class="params">person</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> person &amp;&amp; person.info &amp;&amp; person.info.age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getAge(person) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>你会发现为了取个age，我们需要加很多的判断。当数据中有很多是可选的数据，你会发现你的代码充满了这种类型判断。心累不？</p><p>Okey，Maybe type就是为了解决这个问题的，先让我们实现一个：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Maybe</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">of</span>(x) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Maybe(x);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  get isNothing() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$value === <span class="literal">null</span> || <span class="keyword">this</span>.$value === <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(x) &#123;</span><br><span class="line">    <span class="keyword">this</span>.$value = x;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  map(fn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.isNothing ? <span class="keyword">this</span> : Maybe.of(fn(<span class="keyword">this</span>.$value));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  get() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isNothing) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Get Nothing"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getOrElse(optionValue) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isNothing) &#123;</span><br><span class="line">      <span class="keyword">return</span> optionValue</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>应用一波：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">type Person = &#123;</span><br><span class="line">  info?: &#123;</span><br><span class="line">    age?: string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> prop = curry(<span class="function">(<span class="params">tag, xs</span>) =&gt;</span> xs[tag])</span><br><span class="line"><span class="keyword">const</span> map = curry(<span class="function">(<span class="params">fn, f</span>) =&gt;</span> f.map(fn))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">info</span>: &#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// safe get age</span></span><br><span class="line">Maybe.of(person.info).map(prop(<span class="string">"age"</span>)) <span class="comment">// Nothing</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// safe get age Point free style</span></span><br><span class="line"><span class="keyword">const</span> safeInfo = <span class="function"><span class="params">xs</span> =&gt;</span> Maybe.of(person.info)</span><br><span class="line"><span class="keyword">const</span> getAge = compose(map(prop(<span class="string">'age'</span>)), safeInfo)</span><br><span class="line">getAge(person) <span class="comment">// Nothing</span></span><br></pre></td></tr></table></figure><p>来复盘一波，上面的map依然是一个functor（函子）。不过呢，在做类型转换的时候加上了逻辑：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">map(fn) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.isNothing ? <span class="keyword">this</span> : Maybe.of(fn(<span class="keyword">this</span>.$value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以也就是上面的转换关系可以表示为：</p><p><img src="/images/Mapbe_type.svg" alt=""></p><p>其实一看图就出来了，“哦，你把判断移动到了map里面。有啥用？”。ok，罗列一下好处：</p><ol><li>更安全</li><li>将判断逻辑进行封装，代码更简洁</li><li>声明式代码，没有各种各样的判断</li></ol><p>其实，不确定性，也是一种副作用。对于可选的数据，我们在运行时是很难确定他的真实的数据类型的，我们用<code>Maybe</code>封装一下其实本身就是封装这种不确定性。这样就能保证我们的一个入参只有可能会返回一种输出了。</p></div></div></div><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section><footer class="footer"><div>我是一个粉刷匠</div><div>由 <a href="https://hexo.io/">Hexo</a> 强力驱动 | 主题- <a href="https://github.com/wszgxa/hexo-theme-simple">Simple</a></div></footer></div></div><script src="/js/simple_build.js"></script><script type="text/javascript">function run_disqus_script(s){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+disqus_shortname+".disqus.com/"+s,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}var disqus_shortname="hilus-note",disqus_identifier="2018/10/13/FP-with-JS-functor/",disqus_title="JS函数式编程 - 函子和范畴轮",disqus_url="http://hiluluke.cn/2018/10/13/FP-with-JS-functor/";run_disqus_script("count.js"),run_disqus_script("embed.js")</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-83014983-1","auto"),ga("send","pageview")</script></body></html>