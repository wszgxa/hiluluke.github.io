<!DOCTYPE html>
<html>
  <head>
    
    <title>canvas 笔记（1） | hilu&#39;s note</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="utf-8">
    <link rel="alternate" href="/atom.xml" title="hilu&#39;s note" type="application/atom+xml">
    
    <link rel="icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">
  </head>
<body>
  <script type="text/javascript">
    // fix sidebar flashing
    (function(){
      if (localStorage.getItem('sidebarState') == 'true') {
        document.body.className="sideShow"
      }
    })()
  </script>
  <div id="container">
    <aside class="sidebar">
  <div class="head-icon">
  
    <a href="/about">
      <img src="/avatar.jpeg">
    </a>
  
  </div>
  <div class="name">hiluluke</div>
  <div class="desc">
    <h4>我是一个粉刷匠</h4>  
  </div>
  <nav class="side-nav">
    <div class="nav-item">
      <a href="/archives">
        <span>
          26
        </span>
        <span>日志</span>
      </a>
    </div>
    <div class="nav-item">
      <a href="/categories">
        <span>
          7
        </span>
        <span>分类</span>
      </a>
    </div>
    <div class="nav-item">
      <a href="/tags">
        <span>
          22
        </span>
        <span>标签</span>
      </a>
    </div>
  </nav>
  
  <div class="social-wrap">
    
    <a href="https://github.com/wszgxa" target="_blank">
      <div class="item">
        <i class="i-github"></i>
      </div>
    </a>
    
    <a href="http://v2ex.com/member/hiluluke" target="_blank">
      <div class="item">
        <i class="i-v2ex"></i>
      </div>
    </a>
    
    <a href="https://www.zhihu.com/people/zhao-guo-xu" target="_blank">
      <div class="item">
        <i class="i-zhihu"></i>
      </div>
    </a>
    
    <a href="https://twitter.com/Hiluluke" target="_blank">
      <div class="item">
        <i class="i-twitter"></i>
      </div>
    </a>
    
    <a href="http://codepen.io/hiluluke" target="_blank">
      <div class="item">
        <i class="i-codepen"></i>
      </div>
    </a>
    
  </div>
  
</aside>
    <div class="wrap">
      <div class="side">
  <div class="top" id="back-top"></div>
  <div class="arrows" id="nav-btn"></div>
</div>
      <header class="header">
  <div class="arrows" id="nav-btn"></div>
</header>
      <section id="main" class="content">
        
<section class="archives-wrap">
  <div class="archives">
    <div class="title-wrap">
      <h1>canvas 笔记（1）</h1>
      <div class="page-info">
      
        <span>By <a href="/about">Hilu Luke</a> on</span>
      
        <time datetime="2015-10-24T16:00:00.000Z" itemprop="datePublished">Oct 25 2015</time>
      </div>
    </div>
    <div class="content-wrap">
    <h2 id="初步"><a href="#初步" class="headerlink" title="初步"></a>初步</h2><p>首先需要在html中定义html结构<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"mycanvas"</span> <span class="attr">width</span>=<span class="string">"600"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后需要在js上获取canvas和定义动画类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"mycanvas"</span>); <span class="comment">//获取canvas</span></div><div class="line"><span class="keyword">var</span> context = canvas.getContext(<span class="string">"2d"</span>);<span class="comment">//定义2d动画</span></div></pre></td></tr></table></figure>
<p>然后就可以进行一些绘图操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">context.lineWidth = <span class="number">10</span>;定义线条宽度</div><div class="line">context.strokeStyle = <span class="string">"blue"</span>;<span class="comment">//定义线条样式（颜色）</span></div><div class="line">context.moveTo(<span class="number">50</span>, canvas.height)；移动光标</div><div class="line">contex.lineTo(x,y)<span class="comment">//从光标的位置画一条线到(x,y)</span></div><div class="line">context.stroke()绘图</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="线条"><a href="#线条" class="headerlink" title="线条"></a>线条</h2><h3 id="画弧"><a href="#画弧" class="headerlink" title="画弧"></a>画弧</h3><ul>
<li>context.arc(a, b, c, d, e, f);</li>
</ul>
<p>第一个参数，第二个参数是圆心坐标，第三个参数是开始弧度，第四个是结束弧度。最后一个参数是方向False = 顺时针，true = 逆时针。</p>
<ul>
<li>context.arcTo(x1, y1, x2, y2, radius);</li>
</ul>
<p>(x1,y1)弧的起点 （x2，y2）弧的终点 radius半径</p>
<h3 id="画二次曲线"><a href="#画二次曲线" class="headerlink" title="画二次曲线"></a>画二次曲线</h3><ul>
<li>context.quadraticCurveTo(controlX, controlY, endingPointX, endingPointY);</li>
</ul>
<p><img src="http://7fvhwe.com1.z0.glb.clouddn.com/选区_024.png" alt=""></p>
<p>其中context point是开始的光标位置。其中有4个相切。midpoint1,2上各有两个正切</p>
<h3 id="画贝塞尔曲线"><a href="#画贝塞尔曲线" class="headerlink" title="画贝塞尔曲线"></a>画贝塞尔曲线</h3><ul>
<li>context.bezierCurveTo(controlPointX1, controlPointY1,controlPointX2, controlPointY2, endingPointX, endingPointY);</li>
</ul>
<p>!()[<a href="http://7fvhwe.com1.z0.glb.clouddn.com/选区_025.png" target="_blank" rel="external">http://7fvhwe.com1.z0.glb.clouddn.com/选区_025.png</a>]</p>
<h3 id="线段端点"><a href="#线段端点" class="headerlink" title="线段端点"></a>线段端点</h3><ul>
<li><p>context.linejoin=x;线交点样式<br>其中x有3个选线：bevel（斜角）、round（圆角）、miter（默认尖角）</p>
</li>
<li><p>context.linegap=x;线的端点样式<br>其中x有3个参数：butt（默认，平直边缘）、round(圆形线帽)、square（正方形线帽）</p>
</li>
</ul>
<h2 id="文字"><a href="#文字" class="headerlink" title="文字"></a>文字</h2><p>context.font = “40pt Calibri”;设置字体大小<br>context.fillText(“Hello World!”, canvas.width / 2, 120);绘文字<br>context.strokeText(“Hello World!”, x, y);等价于上面</p>
<h2 id="线条demo：分型树"><a href="#线条demo：分型树" class="headerlink" title="线条demo：分型树"></a>线条demo：分型树</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawBranches</span>(<span class="params">context, startX, startY, trunkWidth, level</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (level &lt; <span class="number">12</span>) &#123;</div><div class="line">    <span class="keyword">var</span> changeX = <span class="number">100</span> / (level + <span class="number">1</span>);</div><div class="line">    <span class="keyword">var</span> changeY = <span class="number">200</span> / (level + <span class="number">1</span>);</div><div class="line">    <span class="keyword">var</span> topRightX = startX + <span class="built_in">Math</span>.random() * changeX+<span class="number">10</span>;</div><div class="line">    <span class="keyword">var</span> topRightY = startY - <span class="built_in">Math</span>.random() * changeY;</div><div class="line">    <span class="keyword">var</span> topLeftX = startX - <span class="built_in">Math</span>.random() * changeX<span class="number">-10</span>;</div><div class="line">    <span class="keyword">var</span> topLeftY = startY - <span class="built_in">Math</span>.random() * changeY;</div><div class="line">    <span class="comment">// draw right branch</span></div><div class="line">    context.beginPath();</div><div class="line">    context.moveTo(startX + trunkWidth / <span class="number">4</span>, startY);</div><div class="line">    context.quadraticCurveTo(startX + trunkWidth / <span class="number">4</span>, startY - trunkWidth, topRightX, topRightY);</div><div class="line">    context.lineWidth = trunkWidth;</div><div class="line">    context.lineCap = <span class="string">"round"</span>;</div><div class="line">    context.stroke();</div><div class="line">    <span class="comment">// draw left branch</span></div><div class="line">    context.beginPath();</div><div class="line">    context.moveTo(startX - trunkWidth / <span class="number">4</span>, startY);</div><div class="line">    context.quadraticCurveTo(startX - trunkWidth / <span class="number">4</span>, startY - trunkWidth, topLeftX, topLeftY);</div><div class="line">    context.lineWidth = trunkWidth;</div><div class="line">    context.stroke();</div><div class="line">    drawBranches(context, topRightX, topRightY, trunkWidth * <span class="number">0.7</span>, level + <span class="number">1</span>);</div><div class="line">    drawBranches(context, topLeftX, topLeftY, trunkWidth * <span class="number">0.7</span>, level + <span class="number">1</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="形状"><a href="#形状" class="headerlink" title="形状"></a>形状</h2><h3 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">context.rect(x,y,width,height);</div><div class="line">context.fillStyle = <span class="string">"#8ED6FF"</span>;</div><div class="line">context.fill();</div><div class="line">context.lineWidth = <span class="number">5</span>;</div><div class="line">context.strokeStyle = <span class="string">"black"</span>;</div></pre></td></tr></table></figure>
<p>上述方法绘制一个带边框的矩形。(x,y)为开始绘制的左上定点，width和height为宽高</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">context.fillRect(x,y,width,height);</div><div class="line">context.strokeRect(x,y,width,height);</div></pre></td></tr></table></figure>
<p>上面为绘制填充矩形和描边矩形，就一个没边，一个没填充</p>
<h3 id="画一个圆"><a href="#画一个圆" class="headerlink" title="画一个圆"></a>画一个圆</h3><p>之前画弧的arc</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">context.arc(canvas.width / <span class="number">2</span>, canvas.height / <span class="number">2</span>, <span class="number">70</span>, <span class="number">0</span>, <span class="number">2</span> *<span class="built_in">Math</span>.PI, <span class="literal">false</span>);</div><div class="line">context.fillStyle = <span class="string">"#8ED6FF"</span>;</div><div class="line">context.fill();</div><div class="line">context.lineWidth = <span class="number">5</span>;</div><div class="line">context.strokeStyle = <span class="string">"black"</span>;</div></pre></td></tr></table></figure>
<h3 id="自定义形状和样式"><a href="#自定义形状和样式" class="headerlink" title="自定义形状和样式"></a>自定义形状和样式</h3><ul>
<li>context.closePath();闭合路径</li>
<li>context.fillStyle = fillStyle;其中fillStyle可以是一个颜色，还可以是一个图片也可以是一个渐变对象：<br>   grd = context.createLinearGradient(canvas.width <em> 2 / 5, triangleY, canvas.width </em> 2 / 5, triangleY + triangleHeight);<br>   grd.addColorStop(0, “#8ED6FF”); // light blue<br>   grd.addColorStop(1, “#004CB3”); // dark blue<br>grd = context.createLinearGradient(canvas.width <em> 2 / 5, triangleY, canvas.width </em> 2 / 5, triangleY + triangleHeight);<br>线性渐变上面4个参数分别是渐变开始点的(x,y)坐标和结束点(x,y)坐标</li>
</ul>
<p>然后指定渐变颜色是：<br>grd.addColorStop(0, “#8ED6FF”); // light blue<br>grd.addColorStop(1, “#004CB3”); // dark blue<br>第一个参数是百分比位置，第二个参数是渐变颜色值</p>
<ul>
<li>grd = context.createRadialGradient(centerX, centerY, 10, centerX, centerY, 100);</li>
</ul>
<p>径向渐变和线性渐变差不多,其中第三个参数和第六个参数分别是开始圆的半径和结束圆的半径</p>
<ul>
<li>var pattern = context.createPattern(image,”repeat|repeat-x|repeat-y|no-repeat”);</li>
</ul>
<p>第一个参数可以是image或者video或者画布，第二个参数指定重复。<br>他是指定为fillStyle的。可以用来填充图像、视频、画布。</p>
<h3 id="画透明的形状"><a href="#画透明的形状" class="headerlink" title="画透明的形状"></a>画透明的形状</h3><p>context.globalAlpha = 0.5;<br>设置全局透明度。</p>
<h3 id="save和restore"><a href="#save和restore" class="headerlink" title="save和restore"></a>save和restore</h3><p>context.save();保存之前的样式设置<br>context.restore();恢复之前的样式设置</p>
<h3 id="图形混合运算"><a href="#图形混合运算" class="headerlink" title="图形混合运算"></a>图形混合运算</h3><ul>
<li>context.globalCompositeOperation = x;<br>其中x可以是：source-atop / source-in / source-out / source-over / destination-atop / destionation-in / destionation-out / destination-over / lighter / xor / copy</li>
</ul>
<p><img src="http://7fvhwe.com1.z0.glb.clouddn.com/选区_026.png" alt=""></p>
<p>上面的图都是在相同的位置画一个正方形和一个圆，然后用了不同的globalCompositeOperation得到的不同效果。</p>
<p>注意是先画的正方形后画的圆形</p>
<h2 id="图片和视频"><a href="#图片和视频" class="headerlink" title="图片和视频"></a>图片和视频</h2><h3 id="画一张图"><a href="#画一张图" class="headerlink" title="画一张图"></a>画一张图</h3><ul>
<li><p>context.drawImage(this,x,y)<br>其中this是图片对象，而(x,y)是坐标。一般将上面代码放在image加载回调里面。</p>
</li>
<li><p>裁剪图片</p>
</li>
</ul>
<p>Context.drawImage(imageObj, sourceX, sourceY, sourceWidth, sourceHight,<br>destX, destY, destWidth, destHeight);看下面这张图应该就能懂了</p>
<p><img src="http://7fvhwe.com1.z0.glb.clouddn.com/选区_028.png" alt=""></p>
<ul>
<li>画视频</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">  window.requestAnimFrame = (function(callback)&#123;</div><div class="line">    return window.requestAnimationFrame ||</div><div class="line">    window.webkitRequestAnimationFrame ||</div><div class="line">    window.mozRequestAnimationFrame ||</div><div class="line">    window.oRequestAnimationFrame ||</div><div class="line">    window.msRequestAnimationFrame ||</div><div class="line">    function(callback)&#123;</div><div class="line">      window.setTimeout(callback, 1000 / 60);</div><div class="line">    &#125;;</div><div class="line">  &#125;)();</div><div class="line"></div><div class="line">  function drawFrame(context, video)&#123;</div><div class="line">    context.drawImage(video, 0, 0);</div><div class="line">    requestAnimFrame(function()&#123;</div><div class="line">      drawFrame(context, video);</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  window.onload = function()&#123;</div><div class="line">    var canvas = document.getElementById("myCanvas");</div><div class="line">    var context = canvas.getContext("2d");</div><div class="line">    var video = document.getElementById("myVideo");</div><div class="line">    drawFrame(context, video);</div><div class="line">  &#125;;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">  &lt;video id="myVideo" autoplay="true" loop="true" style="display:none;"&gt;</div><div class="line">  &lt;source src="http://www.html5canvastutorials.com/cookbook/ch3/1369_03_03/BigBuckBunny_640x360.ogv" type="video/ogg"&gt;&lt;source src="http://www.html5canvastutorials.com/cookbook/ch3/1369_03_03/BigBuckBunny_640x360.mp4" type="video/mp4"&gt;</div><div class="line">&lt;/video&gt;</div><div class="line">  &lt;canvas id="myCanvas" width="600" height="360" style="border:1px solid black;"&gt;</div><div class="line">&lt;/canvas&gt;</div></pre></td></tr></table></figure>
<p>主要思想：将video隐藏，然后一帧一帧抓video呈现在canvas</p>
<ul>
<li>获取图片数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> imagedata = context.getImageData(sourceX,sourceY,sourceWidth,sourceHeight)</div></pre></td></tr></table></figure>
<p>参数分别是起点坐标和宽高。<br>获取已经画好的image的数据，其返回一个对象。<br>imagedata.data.length大小数据,其中data表示多少个像素<br>imagedata.width宽度<br>imagedata.height高度数据</p>
<ul>
<li>像素反色</li>
</ul>
<p>context.putImageData(imageData, destX, destY);<br>将image数据放进固定位置</p>
<p>反色代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">context.drawImage(<span class="keyword">this</span>, destX, destY);</div><div class="line"><span class="keyword">var</span> imageData = context.getImageData(sourceX, sourceY,</div><div class="line">sourceWidth, sourceHeight);</div><div class="line"><span class="keyword">var</span> data = imageData.data;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i += <span class="number">4</span>) &#123;</div><div class="line">  data[i] = <span class="number">255</span> - data[i]; <span class="comment">// red</span></div><div class="line">  data[i + <span class="number">1</span>] = <span class="number">255</span> - data[i + <span class="number">1</span>]; <span class="comment">// green</span></div><div class="line">  data[i + <span class="number">2</span>] = <span class="number">255</span> - data[i + <span class="number">2</span>]; <span class="comment">// blue</span></div><div class="line">  <span class="comment">// i+3 is alpha (the fourth element)</span></div><div class="line">&#125;</div><div class="line">  <span class="comment">// overwrite original image with</span></div><div class="line">  <span class="comment">// new image data</span></div><div class="line">  context.putImageData(imageData, destX, destY);</div><div class="line">&#125;;</div><div class="line">  imageObj.src = <span class="string">"jet_300x214.jpg"</span>;</div></pre></td></tr></table></figure>
<ul>
<li>转变图片灰度</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i += <span class="number">4</span>) &#123;</div><div class="line">  <span class="keyword">var</span> brightness = <span class="number">0.34</span> * data[i] + <span class="number">0.5</span> * data[i + <span class="number">1</span>] + <span class="number">0.16</span> * data[i + <span class="number">2</span>];</div><div class="line">  data[i] = brightness; <span class="comment">// red</span></div><div class="line">  data[i + <span class="number">1</span>] = brightness; <span class="comment">// green</span></div><div class="line">  data[i + <span class="number">2</span>] = brightness; <span class="comment">// blue</span></div><div class="line">  <span class="comment">// i+3 is alpha (the fourth element)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>将一个canvas画布转换成data URL<br>可以使用local storge将data url数据存储到本地</li>
</ul>
<p>var dataURL = canvas.toDataURL();</p>
<p>其中返回的dataURL就是data URL<br>将datauri指定在src中就可以载入图片。</p>

    </div>
  </div>
</section>

      </section>
    <footer style="text-align:center">
  啦啦啦，主题搭建中。。。
</footer>
    </div>
  </div>
  <script src="/js/simple_build.js"></script>
</body>
</html>